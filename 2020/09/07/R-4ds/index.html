<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Tianpeng Wang" />



<meta name="description" content="R数据科学的学习，以及使用tidyverse过程中的一些new tricks学习记录。">
<meta name="keywords" content="R,tidyverse">
<meta property="og:type" content="article">
<meta property="og:title" content="R数据科学 R for data sciences">
<meta property="og:url" content="http:&#x2F;&#x2F;wangtp.top&#x2F;2020&#x2F;09&#x2F;07&#x2F;R-4ds&#x2F;index.html">
<meta property="og:site_name" content="Dawn_Wang&#39;s blog">
<meta property="og:description" content="R数据科学的学习，以及使用tidyverse过程中的一些new tricks学习记录。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200826203108.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200826204311.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200826204609.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200826204834.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200826210637.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200826220653.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200826220803.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200829161817.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200829173223.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200829175608.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200829175923.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200830234626.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200830235558.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200831235621.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200901002207.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200901002608.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200901002916.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200901211155.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200901211440.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200901233801.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200901234031.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200903171710.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200903174212.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200904173908.png">
<meta property="og:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200904173846.png">
<meta property="og:updated_time" content="2020-09-07T08:54:40.187Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;gitee.com&#x2F;tianpeng__wang&#x2F;image&#x2F;raw&#x2F;master&#x2F;tianpeng_pic&#x2F;20200826203108.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Dawn_Wang&#39;s blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/sun_lower.png">





    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>R数据科学 R for data sciences | Dawn_Wang&#39;s blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: false,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?aedc54a08bba9284f34d586328a483d2";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.jpeg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Tianpeng Wang</a></h1>
        </hgroup>

        
        <p class="header-subtitle">学习、记录、分享</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="/wangtianpeng19@hotmail.com" title="Email"></a>
                            
                                <a class="fa Github" href="https://github.com/wang-tianpeng" target="_blank" rel="noopener" title="Github"></a>
                            
                                <a class="fa 简书" href="https://www.jianshu.com/u/a64003068454" target="_blank" rel="noopener" title="简书"></a>
                            
                                <a class="fa Twitter" href="https://twitter.com/wang_tianpeng" target="_blank" rel="noopener" title="Twitter"></a>
                            
                                <a class="fa 微信" href="/wechat_id.jpg" title="微信"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bayesian/" rel="tag">Bayesian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Divergence-Time/" rel="tag">Divergence-Time</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dsuite/" rel="tag">Dsuite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/D%E6%A3%80%E9%AA%8C/" rel="tag">D检验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Imputation/" rel="tag">Imputation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Introgression/" rel="tag">Introgression</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ML-Tree/" rel="tag">ML_Tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ortholog/" rel="tag">Ortholog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Perl/" rel="tag">Perl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Phasing/" rel="tag">Phasing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Phylogenomic/" rel="tag">Phylogenomic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Phylogeny/" rel="tag">Phylogeny</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/R/" rel="tag">R</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpeciesTree/" rel="tag">SpeciesTree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/StatQuest/" rel="tag">StatQuest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WGS/" rel="tag">WGS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/find-ortholog-py/" rel="tag">find_ortholog.py</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/introgression/" rel="tag">introgression</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pophelper/" rel="tag">pophelper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/" rel="tag">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tidyverse/" rel="tag">tidyverse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/version-control/" rel="tag">version control</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" rel="tag">博客搭建</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E5%BA%8A/" rel="tag">图床</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E5%9B%A0%E5%9E%8B%E5%A1%AB%E5%85%85/" rel="tag">基因型填充</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E5%9B%A0%E6%B8%90%E6%B8%97/" rel="tag">基因渐渗</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E5%9B%A0%E7%BB%84%E5%88%86%E6%9E%90/" rel="tag">基因组分析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%99%E7%A8%8B/" rel="tag">教程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BE%A4%E4%BD%93%E7%BB%93%E6%9E%84/" rel="tag">群体结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%84%9A%E6%9C%AC/" rel="tag">脚本</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%89%E6%8B%A9%E5%8E%8B%E5%8A%9B/" rel="tag">选择压力</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/" target="_blank" rel="noopener">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://xuzhougeng.top/" target="_blank" rel="noopener">xuzhougeng</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">记录</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Tianpeng Wang</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.jpeg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Tianpeng Wang</a></h1>
            </hgroup>
            
            <p class="header-subtitle">学习、记录、分享</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="/wangtianpeng19@hotmail.com" title="Email"></a>
                            
                                <a class="fa Github" target="_blank" href="https://github.com/wang-tianpeng" title="Github"></a>
                            
                                <a class="fa 简书" target="_blank" href="https://www.jianshu.com/u/a64003068454" title="简书"></a>
                            
                                <a class="fa Twitter" target="_blank" href="https://twitter.com/wang_tianpeng" title="Twitter"></a>
                            
                                <a class="fa 微信" target="_blank" href="/wechat_id.jpg" title="微信"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-R-4ds" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/09/07/R-4ds/" class="article-date">
      <time datetime="2020-09-07T14:48:30.000Z" itemprop="datePublished">2020-09-07</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      R数据科学 R for data sciences
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/R/">R</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/R/" rel="tag">R</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tidyverse/" rel="tag">tidyverse</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul>
<li><code>reprex</code>包：创建简单的可重现实例。检查问题所在。</li>
</ul>
<h2 id="一-使用ggplot2进行数据可视化"><a href="#一-使用ggplot2进行数据可视化" class="headerlink" title="一 使用ggplot2进行数据可视化"></a>一 使用ggplot2进行数据可视化</h2><ol>
<li>坐标系<code>ggplot()</code>，在此函数种添加的映射会作为全局变量应用到图中的每个几何对象种。</li>
<li>图层<code>geom_point</code>点图层</li>
<li><strong>映射数据为图形属性</strong> <code>mapping=aes()</code>，要想将图形属性映射为变量，需要在函数aes()中将图形属性的名称和变量的名称关联起来。</li>
<li>标度变化：将变量（数据）分配唯一的图形属性水平。</li>
<li>手动设置图形属性，此是在geom_point()层面。此时，<strong>这个颜色是不会传达变量数据的信息。</strong></li>
<li>分层<strong>facet</strong>：<code>facet_grid()</code>可以通过两个变量对图分层`facet_grid(drv<del>cyl)或(.</del>cyl)</li>
<li><strong>分组</strong><code>aes(group)</code>此种按照图形属性的分组不用添加图例，也不用为几何对象添加区分特征</li>
<li><strong>统计变换</strong>：绘图时用来计算新数据的算法称为stat(statistical transformation,统计变化)。比如对于<code>geom_bar()</code>默认是只对一个数据x映射，其统计变化后生成数据x种的每个值的count数。<ul>
<li>每个几何对象函数都有一个默认的统计变换，每个统计变换函数都有一个默认的几何对象。</li>
<li><strong>如需要展示二维柱状图数据，geom_bar(mapping=aes(x=a,y=b),stat=”identity “)</strong></li>
</ul>
</li>
</ol>
<p><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200826203108.png" alt=""></p>
<ol start="9">
<li><strong>图形属性/位置调整</strong>：<ul>
<li><code>color</code>,<code>fill</code></li>
<li>位置调整参数<code>position</code>有三个选项：”identity”,”fill”,”dodge”</li>
<li><code>position=&quot;dodge&quot;</code>参数可分组显示数据，将每组种的条形依次并列放置，可以轻松比较每个条形表示的具体数值。<br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200826204311.png" alt=""></li>
<li>数据的聚集模式无法很好确定，因为存在数据的<strong>过绘制</strong>问题（很多彼此十分近的点重叠了）<code>position=&quot;jitter&quot;</code>对于geom_position()函数来说，<strong>jitter</strong>的位置方式为抖动会排除过绘制问题<code>ggplot(data = mpg) + 
geom_point(mapping = aes(x = displ, y = hwy), position = &quot;jitter&quot;)</code></li>
</ul>
</li>
<li><strong>坐标系</strong>：<ul>
<li><code>coord_flip()</code>函数可以交换x轴和y轴<br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200826204609.png" alt=""></li>
<li><code>labs()</code>：modify axis, legend, and plot labels.</li>
<li><code>coord_polar()</code>极坐标<img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200826204834.png" alt=""></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">mpg</span><br><span class="line">str(mpg)</span><br><span class="line">data&lt;- mpg</span><br><span class="line">?mpg ##查看mpg数据的说明</span><br><span class="line">ggplot(data = mpg)+geom_point(aes(x=displ,y=hwy))</span><br><span class="line"></span><br><span class="line">ggplot(mpg)+geom_point(mapping = aes(x=displ,y=hwy,color=class),color=&quot;#EF5C4E&quot;,shape=19)</span><br><span class="line">ggplot(mpg)+geom_point(mapping = aes(x=displ,y=hwy),color=&quot;#EF5C4E&quot;,shape=19)</span><br><span class="line">ggplot(mpg)+geom_point(mapping = aes(x=displ,y=hwy,stroke=displ),shape=19)</span><br><span class="line">## 添加两个图层：geom_point,geom_smooth()</span><br><span class="line">ggplot(mpg)+geom_point(mapping = aes(x=displ,y=hwy,color=drv))+geom_smooth(mapping = aes(x=displ,y=hwy,linetype=drv,color=drv))</span><br><span class="line"># 添加分组</span><br><span class="line">ggplot(data = mpg)+geom_smooth(mapping = aes(x=displ,y=hwy,group=drv))</span><br><span class="line">ggplot(data = mpg)+geom_smooth(mapping = aes(x=displ,y=hwy,color=drv),show.legend = F) ## 图例 show.legend=F</span><br><span class="line"></span><br><span class="line">## 在不同的图层中添加指定不同的数据</span><br><span class="line">## data=filter(mpg,class==&quot;suv&quot;), se=F，表示去除f波动的范围。</span><br><span class="line">ggplot(data = mpg,mapping = aes(x=displ,y=hwy))+geom_point(mapping = aes(color=class))+geom_smooth(data = filter(.data = mpg,class==&quot;suv&quot;))</span><br><span class="line"></span><br><span class="line">##exercices</span><br><span class="line">ggplot(data = mpg,mapping = aes(x=displ,y=hwy))+geom_point()+geom_smooth(se = F)</span><br><span class="line">ggplot(data = mpg,mapping = aes(x=displ,y=hwy))+geom_point()+geom_smooth(se = F,mapping = aes(group=drv))</span><br><span class="line">ggplot(data = mpg,mapping = aes(x=displ,y=hwy,color=drv))+geom_point()+geom_smooth(se = F)</span><br><span class="line">ggplot(data = mpg,mapping = aes(x=displ,y=hwy))+geom_point(mapping = aes(color=drv))+geom_smooth(se = F)</span><br><span class="line">ggplot(data = mpg,mapping = aes(x=displ,y=hwy))+geom_point(mapping = aes(color=drv))+geom_smooth(mapping = aes(linetype=drv),se = F)</span><br><span class="line">ggplot(data = mpg,mapping = aes(x=displ,y=hwy))+geom_point(mapping = aes(color=drv))</span><br><span class="line"></span><br><span class="line">### 统计变换</span><br><span class="line">ggplot(data = mpg,mapping = aes(x=displ,y=hwy))+geom_point()+geom_smooth(se = F)</span><br><span class="line">ggplot(data=diamonds)+stat_summary(mapping = aes(x=cut,y=depth))</span><br><span class="line">ggplot(data=diamonds)+geom_boxplot(mapping = aes(x=cut,y=price))</span><br><span class="line">ggplot(data=diamonds)+geom_bar(mapping = aes(x=cut))</span><br><span class="line">ggplot(data=diamonds)+geom_bar(mapping = aes(x=cut,y=..prop..),group=2)</span><br><span class="line"></span><br><span class="line">### 图形调整,位置调整</span><br><span class="line">ggplot(diamonds)+geom_bar(mapping = aes(x=cut,fill=cut),color=&quot;black&quot;)+scale_fill_brewer(palette = &quot;Set3&quot;)</span><br><span class="line">ggplot(diamonds)+geom_bar(mapping = aes(x=cut,fill=clarity))+scale_fill_brewer(palette = &quot;Set2&quot;)</span><br><span class="line">ggplot(diamonds)+geom_bar(mapping=aes(x=cut,color=clarity),position = &quot;dodge&quot;)+scale_fill_brewer(palette = &quot;Set2&quot;)</span><br><span class="line">ggplot(mpg)+geom_point(mapping = aes(x=displ,y=hwy),position = &quot;jitter&quot;)</span><br><span class="line">##exercises</span><br><span class="line">ggplot(mpg,mapping = aes(x=cty,y=hwy))+geom_point(position = &quot;jitter&quot;)+geom_smooth(color=&quot;black&quot;)</span><br><span class="line">ggplot(mpg,mapping = aes(x=cty,y=hwy))+geom_jitter()</span><br><span class="line">ggplot(mpg,mapping = aes(x=cty,y=hwy))+geom_count()</span><br><span class="line">ggplot(mpg)+geom_boxplot(mapping = aes(x=manufacturer,y=hwy),position = &quot;identity&quot;)</span><br><span class="line">?geom_boxplot</span><br><span class="line"></span><br><span class="line">###1.9 坐标系</span><br><span class="line">ggplot(mpg,mapping = aes(x=class,y=hwy))+geom_boxplot()+coord_flip()</span><br><span class="line">nz &lt;- map_data(&quot;nz&quot;)</span><br><span class="line">?map_data</span><br><span class="line">ggplot(data=diamonds)+geom_bar(mapping = aes(x=cut,fill=cut),show.legend = FALSE)+theme(aspect.ratio = 1)+labs()</span><br><span class="line">bar+scale_color_brewer(palette = &quot;Set2&quot;)</span><br><span class="line">bar+coord_flip()</span><br><span class="line">bar+coord_polar()</span><br></pre></td></tr></table></figure>



<h2 id="二-工作流：基础-Workflow：basics"><a href="#二-工作流：基础-Workflow：basics" class="headerlink" title="二 工作流：基础 Workflow：basics"></a>二 工作流：基础 Workflow：basics</h2><ol>
<li>赋值：小技巧，<strong>alt+减号</strong>会自动输入赋值符号&lt;- 并在前后加空格</li>
<li>对象：用<strong>snake_case命名法</strong>小写字母，以_分割。</li>
<li>Rstudio中快捷查看命令：Alt+Shift+K</li>
</ol>
<h2 id="三-使用dplyr进行数据转换"><a href="#三-使用dplyr进行数据转换" class="headerlink" title="三 使用dplyr进行数据转换"></a>三 使用dplyr进行数据转换</h2><ol>
<li>特殊的data.frame<code>tibble</code>。</li>
<li>变量variable类型：<ul>
<li>int：</li>
<li>dbl(num的一种？):双精度浮点数变量，或称实数。</li>
<li>chr：字符向量/字符串</li>
<li>dttm：日期+时间</li>
<li>lgl：逻辑型变量</li>
<li>fctr（factor）：因子</li>
<li>date：日期型变量</li>
</ul>
</li>
<li>基础函数：<code>filter()</code>,<code>arrange()</code>,<code>select()</code>,<code>mutate()</code>,<code>summarize()</code>,<code>group_by()</code></li>
<li>使用<code>filter()</code>筛选:<ul>
<li>filter(flights, arr_delay&lt;=10).</li>
<li>比较运算符 ==, !=, &lt;=</li>
<li>逻辑运算符 x &amp; !y, x|y, xor(x,y)<br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200826210637.png" alt=""></li>
<li>缺失值 NA, is.na()</li>
<li><code>%in%</code> ：<code>month %in% c(11, 12)</code></li>
<li><code>distinct(iris, Species)</code>删除重复行</li>
<li><code>sample_n()</code>任意挑选行</li>
<li><code>slice(irsi,10:15)</code></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## filter()</span><br><span class="line">(jan1 &lt;- filter(flights,month==1,day==1))</span><br><span class="line">(dec25 &lt;- filter(flights,month==12,day==25))</span><br><span class="line">filter(flights,month&gt;=11)</span><br><span class="line">(nov_dec &lt;- filter(flights,month %in% c(11,12)))</span><br><span class="line">filter(flights,!(arr_delay&lt;=120 | dep_delay&lt;=120))</span><br><span class="line">NA&gt;=10</span><br><span class="line">x &lt;- NA</span><br><span class="line">is.na(x)</span><br><span class="line">df &lt;- tibble(x=c(1,NA,2))</span><br><span class="line">filter(df,x&gt;1)</span><br><span class="line">filter(df,is.na(x)|x&gt;1)</span><br><span class="line">### exercise</span><br><span class="line">filter(flights,carrier %in% c(&quot;UA&quot;,&quot;AA&quot;,&quot;DL&quot;))</span><br><span class="line">filter(flights,month %in% c(7,8,9))</span><br><span class="line">filter(flights,arr_delay&gt;120 &amp; dep_delay==0)</span><br><span class="line">filter(flights,dep_delay &gt;= 60 &amp; (dep_delay-arr_delay&gt;=30)) </span><br><span class="line">filter(flights,dep_time ==2400| dep_time&lt;=600)</span><br><span class="line">filter(flights,is.na(dep_time))</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><p>使用 <code>arrange()</code>按照列(variable)的值values进行排序</p>
<ul>
<li><code>desc</code>倒序</li>
<li>缺失值排在最后，若想提前可<code>desc(is.na())</code></li>
<li><code>top_n(10,wind)</code>选择wind变量从大到小的前10个。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># arrange()</span><br><span class="line">arrange(flights,desc(dep_delay,arr_delay)) #降序排列</span><br><span class="line">arrange(flights,desc(is.na(dep_delay),arr_delay)) ##将NA值排列到前面</span><br><span class="line"></span><br><span class="line">### find the 5 cars with highest hp without ordering them</span><br><span class="line">mtcars %&gt;% top_n(5, hp)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>使用<code>select()</code>选择列：（数据集会有成千上万个变量，select选出变量的子集）</p>
<ul>
<li>选出year~day之间的列：<code>select(flights, year:day)</code></li>
<li>选出排除year~day列：<code>select(flights,-(year:dat))</code></li>
<li><strong>匹配变量中的名称</strong>： <code>matches(&quot;&quot;)</code>, <code>contains(&quot;ijk&quot;)</code></li>
<li>匹配变量中的开头，结尾名称<code>starts_with(&quot;&quot;)</code>, <code>ends_with()</code>,</li>
<li><code>rename()</code><strong>对列变量重新命名</strong></li>
<li><code>everything()</code><strong>辅助函数来将某几列提前</strong>。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## select()</span><br><span class="line">select(flights,year:day)</span><br><span class="line">select(flights,-(year:day)) ## 不包括year:day</span><br><span class="line">select(flights,starts_with(&quot;s&quot;))</span><br><span class="line">select(flights,ends_with(&quot;e&quot;))</span><br><span class="line">select(flights,matches(&quot;time&quot;))</span><br><span class="line">select(flights,matches(&quot;(.)\\1&quot;))</span><br><span class="line"></span><br><span class="line">rename(flights,tail_num=tailnum) ##对变量进行重命名</span><br><span class="line">select(flights,-(month:day),everything()) ## 结合everything()辅助函数 对某几列提前, 置后同理</span><br><span class="line">select(flights, hour:time_hour,everything())</span><br><span class="line">###exercise</span><br><span class="line">select(flights,year,year,year)</span><br><span class="line">select(flights,one_of(c(&quot;year&quot;,&quot;month&quot;,&quot;day&quot;,&quot;dep_delay&quot;)))</span><br><span class="line">select(flights,contains(&quot;TIME&quot;))</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>使用<code>mutate()</code>添加新的列/变量：</p>
<ul>
<li><code>mutate()</code> 新列添加到已有列的后面；</li>
<li><code>transmute</code> 只保留新的变量。</li>
<li>常用的运算符号：<strong>求整%/%</strong>，求余%%，<strong>偏移函数lead(), lag()</strong>，累加和和滚动聚合，逻辑比较，排秩。</li>
<li>==rename()== 可对变量名称进行重新命名。</li>
<li>==rename_all(~str_replace(., “”, “”))== 可以根据正则匹配进行改名。</li>
<li>==mutate_all()== 可对所有observations进行修改。</li>
<li>==case_when()== 根据已有的columns创建新的discrete variables。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># mutate() 在tibble后 添加新变量/列</span><br><span class="line">flights_sml &lt;- select(flights,year:day,matches(&quot;_delay&quot;),distance,air_time)</span><br><span class="line">flights_sml</span><br><span class="line">mutate(flights_sml,flying_delay=arr_delay-dep_delay,speed=distance/air_time * 60 )</span><br><span class="line">flights_sml</span><br><span class="line">transmute(flights,gain=arr_delay-dep_delay,hour=air_time/60,gain_per_hour=gain/hour)</span><br><span class="line"></span><br><span class="line">mutate(flights,dep_time=((dep_time%/%100 * 60)+(dep_time%%100))) ## 会直接在flights中改动dep_time</span><br><span class="line">flights</span><br><span class="line">transmute(flights,air_time,duration=(arr_time-dep_time),arr_delay)</span><br><span class="line">1:3+1:10</span><br><span class="line">1:10+1:3</span><br><span class="line">1:10</span><br><span class="line">?cos</span><br><span class="line"></span><br><span class="line">#### 变量名variable names 重新命名。</span><br><span class="line">iris %&gt;% </span><br><span class="line">  rename_all(tolower) %&gt;% </span><br><span class="line">  rename_all(~str_replace_all(., &quot;\\.&quot;, &quot;_&quot;))</span><br><span class="line"></span><br><span class="line">#### 观测 observation 和 values 值修改</span><br><span class="line">storms %&gt;% </span><br><span class="line">    select(name,year,status) %&gt;% </span><br><span class="line">    mutate_all(tolower) %&gt;% </span><br><span class="line">    mutate_all(~str_replace_all(., &quot;\\s&quot;, &quot;_&quot;))</span><br><span class="line"></span><br><span class="line">storms %&gt;% </span><br><span class="line">    select(name,year,status) %&gt;% </span><br><span class="line">    map(~str_replace(.,&quot;\\s&quot;,&quot;_&quot;)) %&gt;% </span><br><span class="line">    as_tibble()</span><br><span class="line"></span><br><span class="line">#### make new discrete variables based on other columns.</span><br><span class="line">starwars %&gt;%</span><br><span class="line">  select(name, species, homeworld, birth_year, hair_color) %&gt;%</span><br><span class="line">  mutate(new_group = case_when(</span><br><span class="line">      species == &quot;Droid&quot; ~ &quot;Robot&quot;,</span><br><span class="line">      homeworld == &quot;Tatooine&quot; &amp; hair_color == &quot;blond&quot; ~ &quot;Blond Tatooinian&quot;,</span><br><span class="line">      homeworld == &quot;Tatooine&quot; ~ &quot;Other Tatooinian&quot;,</span><br><span class="line">      hair_color == &quot;blond&quot; ~ &quot;Blond non-Tatooinian&quot;,</span><br><span class="line">      TRUE ~ &quot;Other Human&quot;))</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>使用<code>summarize()</code>进行分组摘要：</p>
<ul>
<li>与<code>group_by</code>一起使用，将整个数据集的单位缩小为单个分组。</li>
<li>==<code>add_count()</code>== 添加个数统计，而不用summarize<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 使用summarize()进行分组摘要</span><br><span class="line">by_year &lt;- group_by(flights,year,month)</span><br><span class="line">summarise(by_year,delay=mean(arr_delay-dep_delay,na.rm = T))</span><br><span class="line">####查看</span><br><span class="line">(delay_byDay &lt;- group_by(flights,month) %&gt;%summarise(delay_time=mean(dep_delay,na.rm = T))) %&gt;% ggplot(mapping = aes(x=month,y=delay_time))+geom_point()+geom_smooth(se=F)</span><br><span class="line"></span><br><span class="line">#### add the amount of observations without summarising them, and rename them with rename() statement.</span><br><span class="line">mtcars %&gt;% </span><br><span class="line">  select(-(drat:vs)) %&gt;% </span><br><span class="line">  add_count(cyl) %&gt;% rename(n_cyl = n) %&gt;% </span><br><span class="line">  add_count(am) %&gt;% rename(n_am = n)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>利用管道符<code>%&gt;%</code>对数据综合操作：</p>
<ul>
<li>综合就是<code>flights %&gt;% group_by(~) %&gt;% summarize(mean(~~,na.rm=T)) %&gt;% filter(~) %&gt;% ggplot(aes())+geom_~()</code></li>
<li>缺失值：<code>na.rm=T</code>，缺失值计算会都变成缺失值，可利用<code>filter(!is.na(dep_delay),!is.na(arr_delay))</code></li>
<li>常用的摘要函数：<code>n()</code>, <code>sum()</code>, <code>mean()</code></li>
<li>中位数<code>median()</code>，分散程度<code>sd()</code>/<code>IQR()</code>/<code>mad()</code></li>
<li>计数 <code>n()</code>, <strong>计算唯一值的数量<code>n_distinct()</code></strong> 去重复后唯一值的计数，<code>count()</code>可快速的计算。</li>
<li><strong>逻辑值的计数 和 比例</strong>：<code>summarize(n_early=sum(dep_time&lt;50))</code>,sum找出大于x的True的数量，mean会计算比例。</li>
</ul>
</li>
<li><p>将group_by与filter和mutate结合使用</p>
<ul>
<li>根据不同的分组，再利用<code>filter</code>进行筛选<code>flights_sml %&gt;% group_by(year, month, day) %&gt;%  filter(rank(desc(arr_delay)) &lt; 10)</code></li>
</ul>
</li>
<li><p>其它一些dplyr中的函数</p>
<ul>
<li><code>distinct(&quot;&quot;, .keep_all=T)</code> base中的unique替代函数。</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"># 使用summarize()进行分组摘要</span><br><span class="line">by_year &lt;- group_by(flights,year,month)</span><br><span class="line">summarise(by_year,delay=mean(arr_delay-dep_delay,na.rm = T))</span><br><span class="line">####查看</span><br><span class="line">(delay_byDay &lt;- group_by(flights,month) %&gt;%summarise(delay_time=mean(dep_delay,na.rm = T))) %&gt;% ggplot(mapping = aes(x=month,y=delay_time))+geom_point()+geom_smooth(se=F)</span><br><span class="line"></span><br><span class="line">### 使用管道组合多种操作</span><br><span class="line">(delay_by_dest &lt;- group_by(flights,dest)%&gt;%summarise(count=n(),delay_time=mean(dep_time,na.rm = T), dist=mean(distance,na.rm = T))) %&gt;% filter(count&gt;20,dest!=&quot;HNL&quot;) %&gt;% ggplot(mapping = aes(x=dist,y=delay_time))+geom_point(aes(size=count))+geom_smooth(se=F,color=&quot;darkblue&quot;)</span><br><span class="line"></span><br><span class="line">## 管道符 %&gt;%</span><br><span class="line">(delay &lt;- summarise(by_dest,count=n(),dist=mean(distance,na.rm = T),delay=mean(arr_delay,na.rm = T))) ### count=n()统计分组，就是dest城市的个数</span><br><span class="line">delay &lt;- filter(delay,count&gt;20,dest!=&quot;HNL&quot;)## 筛掉飞行记录少的，特殊机场</span><br><span class="line">ggplot(data = delay,mapping = aes(x=dist,y=delay))+geom_point(aes(size=count),alpha=1/3)+geom_smooth(se=F,color=&quot;darkblue&quot;)</span><br><span class="line">(delay_by_dest &lt;- group_by(flights,dest)%&gt;%summarise(count=n(),delay_time=mean(dep_time,na.rm = T), dist=mean(distance,na.rm = T))) %&gt;% filter(count&gt;20,dest!=&quot;HNL&quot;) %&gt;% ggplot(mapping = aes(x=dist,y=delay_time))+geom_point(aes(size=count))+geom_smooth(se=F,color=&quot;darkblue&quot;)</span><br><span class="line">##查看飞机型号与延误时间的关系</span><br><span class="line">flights %&gt;% group_by(tailnum) %&gt;%summarise(count=n(),delay_time=mean(arr_delay,na.rm = T)) %&gt;%arrange(delay_time) %&gt;%ggplot(mapping = aes(x=delay_time))+geom_freqpoly(binwidth = 10)</span><br><span class="line">##查看航班数量 与 飞机延误时间的关系：航班数量少时，平均延误时间的变动特别大</span><br><span class="line">delay_time %&gt;% filter(count&gt;25) %&gt;% ggplot(mapping = aes(x=count,y=delay_time))+geom_point(alpha=1/5)</span><br><span class="line">##其他常用的统计函数</span><br><span class="line">flights_not_cancelled %&gt;% group_by(dest) %&gt;% summarise(carrier=n())</span><br><span class="line">flights_not_cancelled %&gt;% group_by(dest) %&gt;% summarise(carriers=n_distinct(carrier))</span><br><span class="line">flights_not_cancelled %&gt;% group_by(tailnum) %&gt;% summarise(sum(distance))</span><br><span class="line"> </span><br><span class="line">###exercises</span><br><span class="line">##### 查看哪个航空公司延误时间最长</span><br><span class="line">flights_not_cancelled %&gt;% group_by(carrier) %&gt;% summarise(count=n(),arr_delay_time=mean(arr_delay)) %&gt;% arrange(desc(arr_delay_time)) %&gt;% ggplot(mapping = aes(x=carrier,y=arr_delay_time))+geom_point(aes(size=count))</span><br><span class="line"></span><br><span class="line">### 将group_by和filter结合</span><br><span class="line">flights_sml %&gt;% </span><br><span class="line">  group_by(year, month, day) %&gt;%</span><br><span class="line">  filter(rank(desc(arr_delay)) &lt; 10)</span><br><span class="line">#&gt; # A tibble: 3,306 x 7</span><br><span class="line">#&gt; # Groups:   year, month, day [365]</span><br><span class="line">#&gt;    year month   day dep_delay arr_delay distance air_time</span><br><span class="line">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span><br><span class="line">#&gt; 1  2013     1     1       853       851      184       41</span><br><span class="line">#&gt; 2  2013     1     1       290       338     1134      213</span><br><span class="line">#&gt; 3  2013     1     1       260       263      266       46</span><br><span class="line">#&gt; 4  2013     1     1       157       174      213       60</span><br><span class="line">#&gt; 5  2013     1     1       216       222      708      121</span><br><span class="line">#&gt; 6  2013     1     1       255       250      589      115</span><br><span class="line">#&gt; # … with 3,300 more rows</span><br><span class="line"></span><br><span class="line">popular_dests &lt;- flights %&gt;% </span><br><span class="line">  group_by(dest) %&gt;% </span><br><span class="line">  filter(n() &gt; 365)</span><br><span class="line">popular_dests</span><br><span class="line">#&gt; # A tibble: 332,577 x 19</span><br><span class="line">#&gt; # Groups:   dest [77]</span><br><span class="line">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span><br><span class="line">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span><br><span class="line">#&gt; 1  2013     1     1      517            515         2      830            819</span><br><span class="line">#&gt; 2  2013     1     1      533            529         4      850            830</span><br><span class="line">#&gt; 3  2013     1     1      542            540         2      923            850</span><br><span class="line">#&gt; 4  2013     1     1      544            545        -1     1004           1022</span><br><span class="line">#&gt; 5  2013     1     1      554            600        -6      812            837</span><br><span class="line">#&gt; 6  2013     1     1      554            558        -4      740            728</span><br><span class="line">#&gt; # … with 332,571 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span><br><span class="line">#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span><br><span class="line">#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span><br></pre></td></tr></table></figure>
<ol start="10">
<li>取消分组：<code>ungroup()</code>函数：</li>
</ol>
<h2 id="五，探索性数据分析-exploratory-data-analysis-EDA"><a href="#五，探索性数据分析-exploratory-data-analysis-EDA" class="headerlink" title="五，探索性数据分析 exploratory data analysis(EDA)"></a>五，探索性数据分析 exploratory data analysis(EDA)</h2><p><strong>变动</strong>：是一个变量内部的行为，每次测量时数据值的变化趋势。<br><strong>相关变动</strong>：两个或多个变量以相关的方式共同变化所表现出的趋势。多个变量之间的行为。<br><strong>模式</strong>：如果两个变量之间存在系统性的关系，那么这种关系就会再数据中表示一种模式。  </p>
<p>5.3 <strong>变动:variation describes the behavior within a variable</strong></p>
<p>一维数据的表示：<code>geom_bar(binwidth=1)</code>可以对一维连续变量进行分箱，然后使用条形的高度表示落入箱中的数量。并且对于<code>geom_bar()</code>,<code>geom_histogram()</code>可以利用<code>geom_freqpoly()</code>替代，此为叠加的折线图，并可以在折线图内<code>aes(color= *)</code>参数映射其它数据。</p>
<p>异常值：可用图层<code>coord_cartesian(ylim=c(0,50))</code>滤出（不显示，但会保留）大于此取值的，而不是ylim(0,50)直接丢弃。</p>
<ul>
<li><strong>将异常值当做缺失值处理</strong>：利用<code>mutate()</code>函数创建新变量代替原来的变量，使用ifelse()函数将异常值替换为NA：<ul>
<li><code>diamons %&gt;% mutate(y = ifelse(y &lt; 3 | y&gt;20, NA, y))</code></li>
<li>计算画图时以参数<code>na.rm=TRUE</code>过滤掉</li>
</ul>
</li>
<li>异常值差异不大的，可以用缺失值来代替，而异常值较大的需要探究其原因。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">## 5.3 变动，分布进行可视化表示</span><br><span class="line">ggplot(data = diamonds)+geom_bar(mapping = aes(x=cut))</span><br><span class="line">ggplot(data = diamonds)+geom_bar(mapping = aes(x=carat),binwidth = 0.5)</span><br><span class="line">diamonds %&gt;% filter(carat&lt;3) %&gt;% ggplot(mapping = aes(x=carat))+geom_histogram(binwidth = 0.1)</span><br><span class="line">diamonds %&gt;% filter(carat&lt;3) %&gt;% ggplot(mapping = aes(x=carat))+ geom_freqpoly(aes(color=cut),binwidth=0.1)+scale_color_brewer(palette = &quot;Set1&quot;)</span><br><span class="line"></span><br><span class="line">### 5.3.3异常值，</span><br><span class="line">ggplot(diamonds)+geom_histogram(mapping = aes(x=y),binwidth = 0.5)+ylim(0,60)</span><br><span class="line">ggplot(diamonds)+geom_histogram(mapping = aes(x=y),binwidth = 0.5)+coord_cartesian(ylim = c(0,60))</span><br><span class="line"></span><br><span class="line"># 5.4 异常值,推荐是将异常值改为缺失值处理。</span><br><span class="line">diamonds %&gt;% filter(between(y,3,20))</span><br><span class="line">#### mutate()创建新变量代替原来的变量</span><br><span class="line">diamonds &lt;- diamonds %&gt;% mutate(y=ifelse(y&lt;3 | y&gt;30,NA,y))</span><br><span class="line">diamonds &lt;- select(diamonds,-(`ifelse(y &lt; 3 | y &gt; 30, NA, y)`))</span><br><span class="line">ggplot(diamonds,aes(x=x,y=y))+geom_point(na.rm = T)</span><br><span class="line">flights %&gt;% mutate(cancelled=is.na(dep_time),sched_hour=sched_dep_time%/%100,sched_min=sched_dep_time%%100,sched_depart_time=sched_hour+sched_min/60) %&gt;% select(sched_hour,sched_min,sched_depart_time,everything()) %&gt;% ggplot(aes(x=sched_depart_time))+geom_freqpoly(aes(color=cancelled),binwidth=1/5)</span><br></pre></td></tr></table></figure>


<p>5.5 <strong>相关变动covariation describes the behavior between variables</strong>：</p>
<ul>
<li>分类变量与连续变量：<ul>
<li>对<code>geom_freqpoly(aes(color=cut))</code>，对一维的count计数进行标准化可以y=..density..标准化。</li>
<li>箱线图boxplot()标准化：<strong>reorder(class,hwy,FUN=median)</strong> 对分类变量进行排序。<img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200826220653.png" alt=""></li>
</ul>
</li>
<li>两个分类变量：<strong>可以利用heatmap图，geom_tile, geom_count</strong><ul>
<li>geom_count()函数</li>
<li>另外可先count(x,y)计数，再利用<code>geom_tile()</code>和<code>geom_count()</code>填充图形属性。</li>
</ul>
</li>
<li>两个连续变量：<ul>
<li>通常的geom_point(),可通过alpha参数设置透明度。<img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200826220803.png" alt=""></li>
<li>对连续变量数据进行<strong>分箱</strong>，<code>geom_bin2d</code>,<code>geom_hex()</code>可以正方形和六边形分享。</li>
</ul>
</li>
</ul>
<p>5.6 模式和模型：如果两个变量之间存在系统性的关系，那么这种关系就会再数据中表示一种模式。 </p>
<ul>
<li>变动会生成不确定性，那么相关变动就是减少不确定性，如果两个变量是存在系统性的关系的，那么就可以通过一个变量的值来预测另一个变量的值。</li>
<li><strong>模型</strong>：就是抽取模式的一种工具，找到两个变量间系统性关系的方法。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 5.5 相关变动：两个或者多个变量间的关系。</span><br><span class="line">ggplot(diamonds,mapping = aes(x=price))+geom_freqpoly(aes(color=cut),binwidth=500)</span><br><span class="line">ggplot(diamonds)+geom_freqpoly(aes(x=price,y=..density..,color=cut),binwidth=200)+scale_color_brewer(palette = &quot;Set2&quot;)</span><br><span class="line">###mpg</span><br><span class="line">ggplot(mpg,mapping = aes(x=class,y=hwy))+geom_boxplot()</span><br><span class="line">ggplot(mpg)+geom_boxplot(mapping = aes(x=reorder(class,hwy,FUN = mean),y=hwy,fill=class))</span><br><span class="line">ggplot(mpg)+geom_boxplot(mapping = aes(x=reorder(class,hwy,FUN=median),y=hwy))+coord_flip()</span><br><span class="line"></span><br><span class="line">### 5.5.1分类变量与连续变量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 5.5.2俩个分类变量间的关系，geom_tile(aes(fill=count))</span><br><span class="line">ggplot(data = diamonds)+geom_count(mapping = aes(x=cut,y=color))</span><br><span class="line">diamonds %&gt;% count(color,cut) %&gt;% ggplot()+geom_tile(aes(x=color,y=cut,fill=n))</span><br><span class="line"></span><br><span class="line">### 5.5.3 两个连续变量</span><br><span class="line">geom_point()</span><br><span class="line">geom_bin2d() ## 对连续变量的数据做分箱处理。</span><br><span class="line">geom_hex()</span><br><span class="line">diamonds %&gt;% ggplot(aes(carat,price))+geom_hex()</span><br></pre></td></tr></table></figure>
<img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200829161817.jpg" alt=""></li>
</ul>
<h2 id="七，-tibble"><a href="#七，-tibble" class="headerlink" title="七， tibble"></a>七， tibble</h2><p>是对传统R中的data.frame的升级版替换。</p>
<ul>
<li>tibble在打印大数据时会默认仅显示10行(observation)，屏幕可显示的列(variety)</li>
<li>转换传统的data frame to tibble with <code>as_tibble()</code></li>
<li>打印tibble显示在控制台时，有时需要比默认的显示更多的输出。可利用<code>print(n=10,width=Inf)</code> or <code>options(tibble.print_max = n, tibble.print_min = m)</code>, <code>options(tibble.width = Inf)</code>.</li>
<li>==取子集，需要利用占位符df %&gt;% .$x==</li>
<li>一些老的base函数不支持tibble, 可利用<code>as.data.frame()</code>转换回。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">tb &lt;- tibble(</span><br><span class="line">  x = 1:5, </span><br><span class="line">  y = 1, </span><br><span class="line">  z = x ^ 2 + y</span><br><span class="line">)</span><br><span class="line">tb</span><br><span class="line"></span><br><span class="line">nycflights13::flights %&gt;% </span><br><span class="line">  print(n = 10, width = Inf)</span><br><span class="line">  </span><br><span class="line">df %&gt;% .$x</span><br><span class="line">#&gt; [1] 0.7330 0.2344 0.6604 0.0329 0.4605</span><br><span class="line">df %&gt;% .[[&quot;x&quot;]]</span><br><span class="line">#&gt; [1] 0.7330 0.2344 0.6604 0.0329 0.4605</span><br></pre></td></tr></table></figure>




</li>
</ul>
<h2 id="八，-使用readr进行数据的导入"><a href="#八，-使用readr进行数据的导入" class="headerlink" title="八， 使用readr进行数据的导入"></a>八， 使用readr进行数据的导入</h2><p>8.1 常用的tidyverse所提供的数据导入的方式：</p>
<ul>
<li><code>read_csv()</code>：以,分割</li>
<li><code>read_csv2()</code>：以;分割</li>
<li><code>read_tsv()</code>：以\t分割</li>
<li><code>read_delim()</code>：可以读取以任意分隔符的文件delim=”\t” (delimiter 分界符)</li>
</ul>
<p>8.2 <strong>以read_csv()为例，内部提供的函数：</strong></p>
<ul>
<li>skip=2，跳过开头的n行</li>
<li>comment=”#” 跳过以#开头的行</li>
<li>==col_names=FALSE 不以第一行作为列标题。也可col_names=c(“a”,”b”,”c”)来对列进行命名==</li>
<li>na=”.” 设定哪个值为文件的缺失值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read_csv(&quot;file.csv&quot;,skip=1,col_names=c(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;)) ## 读取文件file.csv，跳过第一行，并自定义列的名字。</span><br></pre></td></tr></table></figure>

<p>8.3 解析向量：主要依靠<code>parse_*()</code>函数族解析，第一个参数为需要解析的字符向量，na参数设定 缺失值处理na=”.”，函数族包括parse_logical(), parse_double(), character(), factor(), datetime().</p>
<ul>
<li><strong>parse_number()</strong>可以忽略数值前后的非数值型字符，<strong>可以处理 货币/百分比，提取嵌在文本中的数值</strong></li>
<li>character：UTF-8可以对人类使用的所有字符进行编码，ASCII为美国信息交换标准代码。</li>
<li>因子：表示 <strong>已知集合的分类变量</strong></li>
<li>日期时间等</li>
</ul>
<p>8.4 解析文件：readr会通过文件的前1000行以启发式算法guess_parser()返回readr最可信的猜测，接着用parse_guess()使用这个猜测来解析列。</p>
<p>8.5 写入文件和其它导入文件：</p>
<ul>
<li>通过<code>write_csv</code>,<code>write_tsv</code>，其会自动使用UTF-8对字符串编码。==<code>append=T</code>会覆盖已有文件==</li>
<li><code>write_excel_csv()</code>函数导为Excel文件。</li>
<li><code>readxl</code>可以读取EXCEL文件</li>
<li><code>haven</code>读取SPSS,SAS数据</li>
<li><code>DBI</code>可对RMySQL等数据库查询</li>
<li><code>jsonlite</code>读取JSON的层次数据。</li>
<li><code>xml2</code>读取XML文件数据</li>
</ul>
<h2 id="九，使用tidyr整理数据表-Tidy-data"><a href="#九，使用tidyr整理数据表-Tidy-data" class="headerlink" title="九，使用tidyr整理数据表 Tidy data"></a>九，使用tidyr整理数据表 Tidy data</h2><blockquote>
<p>“Tidy datasets are all alike, but every messy dataset is messy in its own way.” –– Hadley Wickham</p>
</blockquote>
<p>整洁的数据基本准则(以tidyr内部数据table1,table2,table3,table4a,table4b)为例：</p>
<ul>
<li>每个变量(variables)都只有一列；</li>
<li>每个观测(observation)只有一行；</li>
<li>每个数据仅有一个位置cell。</li>
</ul>
<p><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200829173223.png" alt=""></p>
<p>整理数据表，应对一个变量对应多行 or 一个观测对应多行的问题。利用<code>gather</code>，<code>spread()</code></p>
<ol>
<li><p><code>gather()</code>：对于table4a来说，其存在两列1999/2000对应相同的变量值。故需要合并，合并后的两列重新起名字，根据<code>key=&quot;&quot;</code>，和<code>value=&quot;&quot;</code>。</p>
<ul>
<li><code>table4a %&gt;% gather(</code>1999<code>,</code>2000<code>,key=&quot;year&quot;,value=&quot;cases&quot;)</code></li>
<li><code>pivot_longer(c(</code>1999<code>,</code>2000<code>),names_to=&quot;year&quot;,values_to=&quot;cases&quot;)</code><br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200829175608.png" alt=""><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">tidy4a &lt;- table4a %&gt;% </span><br><span class="line">  pivot_longer(c(`1999`, `2000`), names_to = &quot;year&quot;, values_to = &quot;cases&quot;)</span><br><span class="line">tidy4b &lt;- table4b %&gt;% </span><br><span class="line">  pivot_longer(c(`1999`, `2000`), names_to = &quot;year&quot;, values_to = &quot;population&quot;)</span><br><span class="line">left_join(tidy4a, tidy4b)</span><br><span class="line">#&gt; Joining, by = c(&quot;country&quot;, &quot;year&quot;)</span><br><span class="line">#&gt; # A tibble: 6 x 4</span><br><span class="line">#&gt;   country     year   cases population</span><br><span class="line">#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;      &lt;int&gt;</span><br><span class="line">#&gt; 1 Afghanistan 1999     745   19987071</span><br><span class="line">#&gt; 2 Afghanistan 2000    2666   20595360</span><br><span class="line">#&gt; 3 Brazil      1999   37737  172006362</span><br><span class="line">#&gt; 4 Brazil      2000   80488  174504898</span><br><span class="line">#&gt; 5 China       1999  212258 1272915272</span><br><span class="line">#&gt; 6 China       2000  213766 1280428583</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>spread()</code>：对于table2来说，存在冗余。需要拆分出多个变量</p>
<ul>
<li><code>table2 %&gt;% spread(table2,key=type,value=count)</code></li>
<li><code>pivot_wider(names_from = type,values_from=count)</code><br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200829175923.png" alt=""></li>
</ul>
</li>
<li><p><code>separate()</code>：对于table3来说，rate一列数据可以拆分。</p>
<ul>
<li><code>separate(table3,rate,into=c(&quot;cases&quot;,&quot;population&quot;))</code><br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200830234626.png" alt=""></li>
<li><code>sep=</code>参数默认是以非数字 非字母的字符为分隔符，也可以指定分隔符根据正则匹配。sep=4表示以4个字符作为分隔符。</li>
<li>==<code>convert = TRUE</code>表示改变分割后的数据结构。<code>separate()</code>默认切割后的数据结构是character。==</li>
</ul>
</li>
<li><p><code>unite()</code>：对指定两列合并处理。</p>
<ul>
<li>unite(new,centry,year,sep=””)<br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200830235558.png" alt=""></li>
</ul>
</li>
<li></li>
</ol>
<ul>
<li><strong><code>rename()</code>，<code>rename_all()</code>：</strong> <strong>对variables变量进行重命名</strong>。通过library(stringr)。<ul>
<li><code>rename_all(tolower) %&gt;% rename_all(~str_replace_all(., &quot;\\.&quot;, &quot;_&quot;))</code></li>
</ul>
</li>
<li><code>mutate()</code>，<code>mutate_all()</code>：<strong>对所有的value进行重命名，修改名称</strong><ul>
<li><code>mutate_all(tolower) %&gt;% mutate_all(~str_replace_all(., &quot; &quot;, &quot;_&quot;))</code></li>
</ul>
</li>
<li><code>rowwise()</code>，对每行的数据进行处理，加和/平均值处理。<ul>
<li><code>iris %&gt;% select(contains(&quot;Length&quot;)) %&gt;% rowwise() %&gt;% mutate(avg_length = mean(c(Petal.Length, Sepal.Length)))</code></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">## 1 tidy_data</span><br><span class="line">#### compare different dataset</span><br><span class="line">table1</span><br><span class="line">table2</span><br><span class="line">table3</span><br><span class="line">table4a;table4b</span><br><span class="line"></span><br><span class="line">table1 %&gt;% mutate(rate=cases/population *10000)</span><br><span class="line">table1 %&gt;% count(year,wt=cases)</span><br><span class="line">ggplot(table1,aes(year,cases)) + geom_line(aes(color=country))+geom_point(color=&quot;grey&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 2 gather()</span><br><span class="line">table4a</span><br><span class="line">table4a %&gt;% gather(`1999`,`2000`,key = &quot;year&quot;,value = &quot;cases&quot;)</span><br><span class="line">table4b %&gt;% gather(`1999`,`2000`,key=&quot;year&quot;,value=&quot;population&quot;)</span><br><span class="line">left_join(table4a,table4b,by=c(&quot;country&quot;,&quot;year&quot;))</span><br><span class="line"></span><br><span class="line">## 3 spread()</span><br><span class="line">table2</span><br><span class="line">table2 %&gt;% spread(key = type,value = count)</span><br><span class="line"></span><br><span class="line">stocks &lt;- tibble(</span><br><span class="line">  year=c(2015,2015,2016,2016),</span><br><span class="line">  half=c(1,2,1,2),</span><br><span class="line">  return=c(1.88,0.59,0.92,0.17)</span><br><span class="line">)</span><br><span class="line">stocks</span><br><span class="line"></span><br><span class="line">stocks %&gt;% spread(year,return) %&gt;% gather(&quot;year&quot;,&quot;return&quot;,`2015`,`2016`)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 综合操作</span><br><span class="line">who %&gt;%</span><br><span class="line">  gather(new_sp_m014:newrel_f65,key=&quot;key&quot;,value=&quot;count&quot;,na.rm = T) %&gt;%</span><br><span class="line">  mutate(key=str_replace(key,&quot;newrel&quot;,&quot;new_rel&quot;)) %&gt;%</span><br><span class="line">  separate(key,into = c(&quot;new&quot;,&quot;var&quot;,&quot;sexage&quot;),sep=&quot;_&quot;) %&gt;%</span><br><span class="line">  select(-iso2,-iso3,-new) %&gt;%</span><br><span class="line">  separate(sexage,into = c(&quot;sex&quot;,&quot;age&quot;),sep=1)</span><br></pre></td></tr></table></figure>


<h2 id="九，使用dplyr处理关系数据，多个数据表。"><a href="#九，使用dplyr处理关系数据，多个数据表。" class="headerlink" title="九，使用dplyr处理关系数据，多个数据表。"></a>九，使用dplyr处理关系数据，多个数据表。</h2><p>综合多个表中的数据来解决感兴趣的问题。存在于多个表中的数据称为<strong>关系数据</strong>。且<strong>关系总是定义于两个表之间的。</strong> 包括有三类操作处理关系数据：</p>
<ul>
<li>合并数据：在一个表中添加另一个表的新变量，添加新变量的方式是以连接两个表的键来实现的。</li>
<li>筛选连接：在A表中，根据键是否存在于B表中来筛选这个A表中的数据。</li>
<li>集合操作：将观测作为集合元素来处理。</li>
</ul>
<p>基本数据的准备包括<code>nycflights13</code>包中的几个表。airlines/airports/planes/weather等。</p>
<p>9.3 键：<strong>唯一标识</strong>观测的变量（A key is a variable (or set of variables) that uniquely identifies an observation）</p>
<ul>
<li>主键(primary key)：唯一标识 其所在数据表中的观测(不重复)例如planes$tailnum。可利用<code>count() %&gt;% filter(n&gt;1)</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">planes %&gt;% </span><br><span class="line">  count(tailnum) %&gt;% </span><br><span class="line">  filter(n &gt; 1)</span><br><span class="line">#&gt; # A tibble: 0 x 2</span><br><span class="line">#&gt; # … with 2 variables: tailnum &lt;chr&gt;, n &lt;int&gt;</span><br><span class="line"></span><br><span class="line">weather %&gt;% </span><br><span class="line">  count(year, month, day, hour, origin) %&gt;% </span><br><span class="line">  filter(n &gt; 1)</span><br><span class="line">#&gt; # A tibble: 3 x 6</span><br><span class="line">#&gt;    year month   day  hour origin     n</span><br><span class="line">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;int&gt;</span><br><span class="line">#&gt; 1  2013    11     3     1 EWR        2</span><br><span class="line">#&gt; 2  2013    11     3     1 JFK        2</span><br><span class="line">#&gt; 3  2013    11     3     1 LGA        2</span><br></pre></td></tr></table></figure></li>
<li>外键(foreign key)：唯一标识 另一个数据表中的观测例如flights$tailnum。</li>
<li>代理键：当一张表没有主键，需要使用<code>mutate()</code>函数和<code>row_number()</code>函数为表加上一个主键。</li>
<li>理解不同数据表之间的关系的关键时：==<strong>记住每种关系只与两张表有关</strong>==，不需要清楚所有的事情，只需要明白所关心的表格即可。<ul>
<li>例如 flights 与 planes相连接 via tailnum。flights 连接airlines通过carrier.等<br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200831235621.png" alt=""></li>
</ul>
</li>
</ul>
<p>9.4 <strong>合并连接(mutating join)</strong>：通过两个表中的键（变量们）来匹配观测（行数值），再将一个表中的变量复制到另一个表格中。 <strong>对比cheatsheet中的信息</strong></p>
<ul>
<li><p><strong>内连接</strong>：相当于连取交集。将两个表中的相等的键值取出来。<code>X %&gt;% inner_join(y,by=&quot;key&quot;)</code><br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200901002207.png" alt=""></p>
</li>
<li><p><strong>外连接</strong>：至少保留存在于一个表中的观测。在另一个表中未匹配的变量会以<code>NA</code>表示。</p>
<ul>
<li><code>left_join()</code> keeps all observations in x.<strong>最常用的join</strong></li>
<li><code>right_join()</code> keeps all observations in y</li>
<li><code>full_join()</code> keeps all observations in x and y<br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200901002608.png" alt=""></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flights2 %&gt;% left_join(airlines,by=&quot;carrier&quot;)</span><br><span class="line">## in base R</span><br><span class="line"></span><br><span class="line">flights2 %&gt;% mutate(name=airlines$name[match(carrier,airlines$carrier)])</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>重复键</strong>：一对多（），多对一，以及多对多的关系（两表中都不唯一，会以笛卡尔积分的方式呈现）。</p>
</li>
<li><p><strong>定义两个表中匹配的键</strong>：</p>
<ul>
<li>by=NULL，默认，使用存在于两个表中的所有变量。</li>
<li><code>left_join(x,y,by=&quot;weather&quot;)</code></li>
<li><code>left_join(x,y,c(&quot;dest&quot;=&quot;faa &quot;))</code><br><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200901002916.png" alt=""></li>
</ul>
</li>
<li><p>其它Implementations: <strong>base:merge()</strong></p>
<ul>
<li>Baes:merge: <code>left_join(x, y)</code> &lt;=&gt; <code>merge(x, y, all.x = TRUE)</code></li>
<li>SQL: <code>left_join(x, y, by = &quot;z&quot;)</code>    &lt;=&gt; <code>SELECT * FROM x LEFT OUTER JOIN y USING (z)</code></li>
</ul>
</li>
</ul>
<p>9.5 筛选连接(Filtering joins)：<strong>根据键来对观测数值进行筛选，用一组数据来筛选另一组数据</strong></p>
<ul>
<li>semi_join(x,y,by=””)：保留x表中 与 y表中的观测数值相匹配的数据。<ul>
<li><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200901211155.png" alt=""></li>
</ul>
</li>
<li>anti_join(x,y)：丢弃x表中 与y表中观测(行)数据相匹配的数据。<ul>
<li><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200901211440.png" alt=""></li>
</ul>
</li>
</ul>
<p>9.6整理数据时需要对数据进行整理：</p>
<ol>
<li>需要找出每个表中可以作为主键的变量。应基于数据的真实含义来找主键</li>
<li>确保主键中的每个变量没有缺失值，如果有缺失值则不能被识别！</li>
<li>检查主键是否可以与另一个表中的外键相匹配。利用<code>anti_join()</code>来确定。</li>
</ol>
<p>9.7集合的操作：</p>
<ul>
<li><code>intersect(x,y)</code> 两个表中皆存在。</li>
<li><code>union()</code>：返回x表中与y表中的唯一观测。</li>
<li><code>setdiff()</code>：在x表中，但不在y表中的数值。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">library(tidyverse)</span><br><span class="line">library(nycflights13)</span><br><span class="line">planes;airports;airlines;weather;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 9.3键</span><br><span class="line">weather %&gt;% count(year,month,day,hour,origin) %&gt;% filter(n&gt;1) ### 筛选唯一的键</span><br><span class="line"></span><br><span class="line">## 9.4 合并连接</span><br><span class="line">flights2 &lt;- flights %&gt;% select(year:day,hour,origin,dest,tailnum,carrier)</span><br><span class="line">flights2 %&gt;% select(-(hour:origin)) %&gt;% left_join(airlines,by = &quot;carrier&quot;)</span><br><span class="line">flights2 %&gt;% select(-(hour:origin)) %&gt;% right_join(airlines,by = &quot;carrier&quot;)</span><br><span class="line"></span><br><span class="line">flights2 %&gt;% left_join(weather) ## 自然连接,使用存在于两个表中的所有变量。</span><br><span class="line">flights2 %&gt;% left_join(planes,by = &quot;tailnum&quot;) ## 共有的</span><br><span class="line">flights2 %&gt;% left_join(airports,c(&quot;origin&quot; = &quot;faa&quot;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### exercise</span><br><span class="line">##9.4.6-1目的地的平均延误时间，与空间分布。</span><br><span class="line">flights %&gt;% group_by(dest) %&gt;% summarise(dest_delay=mean(arr_delay,na.rm = T)) %&gt;% left_join(airports,c(&quot;dest&quot;=&quot;faa&quot;)) %&gt;% filter(dest_delay&gt;0)%&gt;%ggplot(aes(lon,lat))+borders(&quot;state&quot;)+geom_point(aes(size=dest_delay))</span><br><span class="line"></span><br><span class="line">airports %&gt;% semi_join(flights,c(&quot;faa&quot;=&quot;dest&quot;)) %&gt;% ggplot(aes(lon,lat))+borders(&quot;state&quot;)+geom_point()</span><br><span class="line">##exercise3 飞机的机龄与延误时间</span><br><span class="line">flights %&gt;% group_by(tailnum) %&gt;% summarise(count=n(),delay_tailnum=mean(arr_delay,na.rm = T)) %&gt;% left_join(planes,by=&quot;tailnum&quot;) %&gt;% filter(!is.na(year)) %&gt;% ggplot(aes(x=delay_tailnum))+geom_freqpoly(aes(color=year),binwidth=1)</span><br><span class="line">###geom_ribbon作图</span><br><span class="line"></span><br><span class="line">## 9.5 筛选连接</span><br><span class="line">(top_dest &lt;- flights %&gt;% count(dest,sort = T) %&gt;% head(10))</span><br><span class="line">flights %&gt;% filter(dest %in% top_dest$dest)</span><br><span class="line"></span><br><span class="line">flights %&gt;% semi_join(top_dest,by = &quot;dest&quot;)</span><br></pre></td></tr></table></figure>





<h2 id="十章-使用stringr处理字符串。"><a href="#十章-使用stringr处理字符串。" class="headerlink" title="十章 使用stringr处理字符串。"></a>十章 使用stringr处理字符串。</h2><p>字符串通常包含的是非结构化或者半结构化的数据。</p>
<h5 id="10-1-字符串基础"><a href="#10-1-字符串基础" class="headerlink" title="10.1 字符串基础"></a>10.1 字符串基础</h5><p>R基础函数中含有一些字符串处理函数，但方法不一致，不便于记忆。推荐使用stringr函数。<strong>函数是以str_开头</strong></p>
<ol>
<li>字符串的长度length: <code>str_length()</code></li>
<li>字符串的组合combine: <code>str_c(&quot;x&quot;,&quot;y&quot;,sep = &quot;_&quot;)</code><ul>
<li>向量化函数，自动循环短向量，使得其与最长的向量具有相同的长度</li>
<li>x &lt;- c(“abc”, NA) ; str_c(“1_”,str_replace_na(x),”_1”)</li>
</ul>
</li>
<li>字符串character取子集subsetting strings(==根据位置==)：<code>str_sub(x, start, end)</code>。<strong>如果是一个向量，则对向量中的每个字符串操作，截取子集</strong><ul>
<li>对向量x&lt;- c(“Apple”,”Banana”, “Pear”)中的每个字符串 第一个字母 小写化。==<code>str_sub(x,1,1) &lt;- str_to_lower(str_sub(x,1,1))</code>==</li>
</ul>
</li>
<li>文本转化为大小写：全部大写<code>str_to_upper()</code>, 首字母大写<code>str_to_title()</code></li>
<li>对向量内的strings按照ENGLISH进行排序：<code>str_sort(c(&quot;apple&quot;,&quot;eggplant&quot;,&quot;banana&quot;), locale=&quot;en&quot;)</code></li>
</ol>
<h5 id="10-2-正则匹配"><a href="#10-2-正则匹配" class="headerlink" title="10.2 正则匹配"></a>10.2 正则匹配</h5><p>利用str_view()学习正则匹配，需安装library(htmltools), htmlwidgets</p>
<ol>
<li>str_view(x, “abc”)</li>
<li>锚点：^ $; 单词边界：<code>\b</code>,<strong>如匹配一个单词</strong> <code>\bsum\b</code></li>
<li>特殊匹配符号：\\d, \\s, \\w, [abc], <strong>[^abc]不匹配a/b/c</strong></li>
<li>数量：? +  *  {n,m}  (..)\\1</li>
<li>分组和反引用：(..)\\1</li>
</ol>
<h5 id="10-3-各类匹配操作"><a href="#10-3-各类匹配操作" class="headerlink" title="10.3 各类匹配操作"></a>10.3 各类匹配操作</h5><ol>
<li><p>匹配检测：返回逻辑值TURE(1) or FALSE(0) ==<code>str_detect(x, &quot;e$&quot;)</code>==</p>
<ul>
<li>利用sum(), mean()简单统计匹配的个数。</li>
<li>逻辑取子集方法筛选：words[str_detect(words,”x$”)]</li>
<li><strong>与dplyr使用的另一种技巧</strong> ：<code>df %&gt;% filter(str_detect(words,&quot;ab&quot;))</code></li>
<li>等同于== <code>str_subset(words,&quot;x$&quot;)</code> ==</li>
<li>==<code>str_count(words, &quot;[aeiou]&quot;)</code>== 返回字符串中匹配的数量。</li>
<li>与dplyr一起使用：<code>df %&gt;% mutate( vowels=str_count(w,&quot;[aeiou]&quot;))</code></li>
</ul>
</li>
<li><p>提取匹配的内容：== <code>str_extract()</code> == 只提取第一个匹配的内容。</p>
<ul>
<li><code>str_extract_all(words,color_match)</code>返回一个列表，包含所有匹配的内容。</li>
<li><code>str_extract_all(words,color_match, simplify= TRUE)</code> 返回的是一个矩阵。</li>
<li><strong>注意与str_subset()区别，subset是取子集，取所有匹配到的，无匹配的舍去。子集。而extract是取匹配到的字符串，无匹配到字符串返回NA。可先利用str_subset()找到包含匹配的chr，再用str_extract()</strong> 找到包含的匹配。</li>
<li><code>str_match()</code></li>
<li>利用tidyr里的== <code>extract()</code> ==将字符串向量提取匹配的字符串并转变为tibble</li>
<li><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200901233801.png" alt=""></li>
</ul>
</li>
<li><p>替换匹配的内容 <code>str_replace(words, &quot;match_x&quot;, &quot;replace_x&quot;)</code></p>
<ul>
<li>同时替换多个匹配的内容：<code>str_replace_all()</code></li>
<li>同时执行多个替换：<code>str_replace_all(words,c(&quot;1&quot;=&quot;one&quot;,&quot;2&quot;=&quot;two&quot;,&quot;3&quot;=&quot;three&quot;))</code></li>
<li><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200901234031.png" alt=""></li>
</ul>
</li>
<li><p>拆分 <code>split(sentences,&quot; &quot;)</code>返回的是一个<strong>列表</strong></p>
<ul>
<li><code>&quot;a|b|c|d&quot; %&gt;% str_split(&quot;\\|&quot;) %&gt;% .[[1]]</code></li>
<li>内置的单词边界函数boundary()，会自动识别单词外的字符<code>str_split(x, boundary(&quot;word&quot;))</code></li>
</ul>
</li>
<li><p>定位：<code>str_locate</code>返回匹配在字符串中的位置。</p>
<ul>
<li>使用str_locate()找出匹配的模式，再用str_sub()提取或修改匹配的内容。</li>
</ul>
</li>
<li><p>其它模式：</p>
<ul>
<li><code>regex()</code></li>
<li><code>fixed()</code></li>
<li><code>coll()</code></li>
</ul>
</li>
</ol>
<h5 id="10-5-其它类型的匹配"><a href="#10-5-其它类型的匹配" class="headerlink" title="10.5 其它类型的匹配"></a>10.5 其它类型的匹配</h5><p>对于一个匹配的”pattern”来说，其完整的写法是regex(“pattern”)。而regex()函数中包含其它的参数</p>
<ul>
<li><code>ignore_case=T</code>忽略匹配的大小写</li>
<li><code>multiline=T</code> 可以跨行匹配</li>
<li><code>comments = T</code> 可以添加注释信息</li>
<li><code>dotall=T</code>可以匹配所有字符</li>
</ul>
<p><strong>其它应用：当想不起函数名称时可以<code>apropos(&quot;pattern&quot;)</code></strong></p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能说明</th>
<th>R Base中对应函数</th>
</tr>
</thead>
<tbody><tr>
<td>使用正则表达式的函数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>str_subset()</td>
<td>返回匹配到的子集列表</td>
<td></td>
</tr>
<tr>
<td>str_extract()</td>
<td>提取首个匹配模式的字符</td>
<td>regmatches()</td>
</tr>
<tr>
<td>str_extract_all()</td>
<td>提取所有匹配模式的字符</td>
<td>regmatches()</td>
</tr>
<tr>
<td>str_locate()</td>
<td>返回首个匹配模式的字符的位置</td>
<td>regexpr()</td>
</tr>
<tr>
<td>str_locate_all()</td>
<td>返回所有匹配模式的字符的位置</td>
<td>gregexpr()</td>
</tr>
<tr>
<td>str_replace()</td>
<td>替换首个匹配模式</td>
<td>sub()</td>
</tr>
<tr>
<td>str_replace_all()</td>
<td>替换所有匹配模式</td>
<td>gsub()</td>
</tr>
<tr>
<td>str_split()</td>
<td>按照模式分割字符串</td>
<td>strsplit()</td>
</tr>
<tr>
<td>str_split_fixed()</td>
<td>按照模式将字符串分割成指定个数</td>
<td>-</td>
</tr>
<tr>
<td>str_detect()</td>
<td>检测字符是否存在某些指定模式</td>
<td>grepl()</td>
</tr>
<tr>
<td>str_count()</td>
<td>返回指定模式出现的次数</td>
<td>-</td>
</tr>
<tr>
<td>其他重要函数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>str_sub()</td>
<td>提取指定位置的字符</td>
<td>regmatches()</td>
</tr>
<tr>
<td>str_dup()</td>
<td>丢弃指定位置的字符</td>
<td>-</td>
</tr>
<tr>
<td>str_length()</td>
<td>返回字符的长度</td>
<td>nchar()</td>
</tr>
<tr>
<td>str_pad()</td>
<td>填补字符</td>
<td>-</td>
</tr>
<tr>
<td>str_trim()</td>
<td>丢弃填充，如去掉字符前后的空格</td>
<td>-</td>
</tr>
<tr>
<td>str_c()</td>
<td>连接字符</td>
<td>paste(),paste0()</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">## 10.2 字符串基础</span><br><span class="line">str_length(c(&quot;a&quot;,&quot;aaaaa&quot;,NA)) ## str_length 返回字符串中的字符数量</span><br><span class="line">str_c(&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,sep = &quot; &quot;)</span><br><span class="line">str_c(&quot;aaa&quot;,str_replace_na(c(&quot;bbb&quot;,NA)),&quot;ccc&quot;)</span><br><span class="line"></span><br><span class="line">x &lt;- c(&quot;Apple&quot;,&quot;Banana&quot;,&quot;Pear&quot;)</span><br><span class="line">(str_sub(x,1,1) &lt;- str_to_lower(str_sub(x,1,1)))## 对首字母改为小写。</span><br><span class="line">x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 10.3正则表达式进行模式匹配。</span><br><span class="line">str_view(x,&quot;.a&quot;)</span><br><span class="line">str_view(x,&quot;^a&quot;)</span><br><span class="line"></span><br><span class="line">str_view(words,&quot;^.&#123;7,&#125;$&quot;,match = T) ## exercise 只显示7个字母及以上的单词</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 10.4.1匹配检测</span><br><span class="line">df &lt;- tibble(w=words,i=seq_along(words))</span><br><span class="line">df %&gt;% filter(str_detect(w,&quot;ab&quot;)) ##对于tibble表中筛选。</span><br><span class="line">str_subset(words,&quot;^y&quot;)</span><br><span class="line"></span><br><span class="line">mean(str_count(words,&quot;[aeiou]&quot;)) ## 每个单词中元音字母的数量</span><br><span class="line">df %&gt;% mutate(vowels=str_count(w,&quot;[aeiou]&quot;),consonants=str_count(w,&quot;[^aeiou]&quot;)) ## 与mutate一起使用，加一列匹配到元音字母与非元音字母的数</span><br><span class="line"></span><br><span class="line">####exercises</span><br><span class="line">str_subset(words,&quot;x$|^y&quot;)</span><br><span class="line">words[str_detect(words,&quot;x$|^y&quot;)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 10.4.3 提取匹配内容</span><br><span class="line">colors &lt;- c(&quot;red&quot;,&quot;orange&quot;,&quot;yellow&quot;,&quot;green&quot;,&quot;blue&quot;,&quot;purple&quot;)</span><br><span class="line">(color_match &lt;- str_c(colors,collapse = &quot;|&quot;))</span><br><span class="line">has_color &lt;- str_subset(sentences,color_match) ## 提取包含匹配的整个句子</span><br><span class="line">matches &lt;- str_extract(has_color,color_match) ##匹配包含匹配句子 的 第一个匹配内容。</span><br><span class="line">str(matches)</span><br><span class="line">###exercises</span><br><span class="line">str_extract(sentences,&quot;^\\S+&quot;)</span><br><span class="line">str_extract_all(sentences,&quot;\\w+s&quot;)</span><br><span class="line"></span><br><span class="line">words_ing &lt;- str_subset(sentences,&quot;\\b\\w+ing\\b&quot;)</span><br><span class="line">str_extract_all(words_ing,&quot;\\b\\w+ing\\b&quot;)</span><br><span class="line">## 10.4.5 分组匹配</span><br><span class="line">noun &lt;- &quot;(a|the) (\\S+)&quot;</span><br><span class="line">has_noun &lt;- sentences %&gt;% str_subset(noun)</span><br><span class="line">has_noun %&gt;% str_extract(noun) </span><br><span class="line"></span><br><span class="line">sentences %&gt;% str_subset(noun) %&gt;% str_extract(noun)</span><br><span class="line">str_match(has_noun,noun) ## 可以给出每个独立的分组，返回的是一个矩阵。</span><br><span class="line">tibble(sentence=sentences) %&gt;% extract(col = sentence,into = c(&quot;article&quot;,&quot;noun&quot;),regex = &quot;(a|the) (\\w+)&quot;,remove = F)</span><br><span class="line"></span><br><span class="line">## 10.4.7 替换</span><br><span class="line">str_replace()</span><br><span class="line">str_replace_all(words,c(&quot;1&quot;=&quot;one&quot;,&quot;2&quot;=&quot;two&quot;,&quot;3&quot;=&quot;three&quot;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 10.4.9拆分</span><br><span class="line">&quot;a|b|c|d&quot; %&gt;% str_split(&quot;\\|&quot;) %&gt;% .[[1]]</span><br><span class="line">x &lt;- &quot;This is a sentence&quot;</span><br><span class="line">str_view_all(x,boundary(&quot;word&quot;))  ## 返回句子中的所有单词</span><br><span class="line"></span><br><span class="line">apropos(&quot;str&quot;)</span><br></pre></td></tr></table></figure>







<h2 id="十一章-使用forcats处理因子"><a href="#十一章-使用forcats处理因子" class="headerlink" title="十一章 使用forcats处理因子"></a>十一章 使用forcats处理因子</h2><p>因子在R中用于处理分类变量。分类变量是在固定的已知集合中取值的变量。</p>
<p><strong>使用因子时，最常用的两种操作时修改水平的顺序和水平的值。</strong></p>
<ul>
<li>factor(x1,levels=c(“a”,”b”,”c”))</li>
<li>fct_reorder() ## 重新对factor的层级进行确定。</li>
<li>利用gss_cat数据集，其中一个问题待解决“美国民主党/共和党/中间派的人数比例是如何随时间而变化的”</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">relig_summary &lt;- gss_cat %&gt;%</span><br><span class="line">  group_by(relig) %&gt;%</span><br><span class="line">  summarise(</span><br><span class="line">    age = mean(age, na.rm = TRUE),</span><br><span class="line">    tvhours = mean(tvhours, na.rm = TRUE),</span><br><span class="line">    n = n()</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">ggplot(relig_summary, aes(tvhours, fct_reorder(relig, tvhours))) +</span><br><span class="line">  geom_point()</span><br><span class="line"></span><br><span class="line">### 排序</span><br><span class="line">relig_summary %&gt;%</span><br><span class="line">  mutate(relig = fct_reorder(relig, tvhours)) %&gt;%</span><br><span class="line">  ggplot(aes(tvhours, relig)) +</span><br><span class="line">    geom_point()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十四章-函数-Functions"><a href="#十四章-函数-Functions" class="headerlink" title="十四章 函数(Functions)"></a>十四章 函数(Functions)</h2><p>当一段代码需要多次使用的时候就可以写函数来实现。先编写工作代码，而后再转换成函数的代码。包括<strong>名称/参数/主体代码</strong></p>
<ul>
<li><code>range()</code>返回最小值、最大值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">library(tidyverse)</span><br><span class="line">df &lt;- tibble(a=rnorm(10),</span><br><span class="line">             b=rnorm(10),</span><br><span class="line">             c=rnorm(10),</span><br><span class="line">             d=rnorm(10)</span><br><span class="line">)</span><br><span class="line">x &lt;- df$a</span><br><span class="line">rng &lt;- range(x,na.rm = T) ## range函数返回（最大值和最小值）</span><br><span class="line">(x-rng[1])/(rng[2]-rng[1])</span><br><span class="line"></span><br><span class="line">#### 具体函数</span><br><span class="line">rescale01 &lt;- function(x)&#123;</span><br><span class="line">  rng &lt;- range(x,na.rm = T,finite=T)</span><br><span class="line">  (x-rng[1])/(rng[2]-rng[1])</span><br><span class="line">&#125; ###函数名称为rescale01</span><br><span class="line">rescale01(c(df$a,Inf))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#### exercises</span><br><span class="line">#1, parameters</span><br><span class="line">rescale01_v2 &lt;- function(x,na.rm_TorF,finite_TorF)&#123;</span><br><span class="line">  rng &lt;- range(x,na.rm = na.rm,finite=finite)</span><br><span class="line">  (x-rng[1])/(rng[2]-rng[1])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#2, reverse_Inf</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>命名的规则：函数名一般为<strong>动词</strong>，参数为<strong>名词</strong>。使用注释来解释代码。<ul>
<li>一些广义的动词例如：get, compute, calculate, determine。</li>
<li>如果一组函数功能相似，可以类似于stringr包中的str_combine等改后缀的方法。</li>
<li>==Ctrl + Shift + R== 添加分节的符号</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">## exercises</span><br><span class="line">#1,</span><br><span class="line">f1 &lt;- function(string,prefix)&#123;</span><br><span class="line">  substr(string,1,nchar(prefix))==prefix</span><br><span class="line">&#125;</span><br><span class="line">f3 &lt;- function(x,y)&#123;</span><br><span class="line">  rep(y,length.out(x))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>条件执行(condition execution)：if..else..语句<ul>
<li>condition的值T or F</li>
<li>if..else语句中使用<strong>逻辑表达式</strong>：&amp;&amp; ，||</li>
<li><strong>向量化操作符</strong>： &amp;,| 只可以用于多个值。 </li>
<li>在测试相等关系时，注意 ==是向量化，容易输出多个值。</li>
<li>if .. else if .. else if .. else.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## exercise2欢迎函数</span><br><span class="line">greet &lt;- function(time=lubridate::now())&#123;</span><br><span class="line">  hr &lt;- lubridate::hour(time)</span><br><span class="line">  if(hr&lt;12)&#123;</span><br><span class="line">    print(&quot;Good morning!&quot;)</span><br><span class="line">  &#125;else if (hr&lt;18) &#123;</span><br><span class="line">    print(&quot;Good afternoon&quot;)</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    print(&quot;Good evening&quot;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## exercise3</span><br><span class="line">fizzbuzz &lt;- function(x)&#123;</span><br><span class="line">  ###限定输入的内容格式</span><br><span class="line">  stopifnot(length(x)==1)</span><br><span class="line">  stopifnot(is.numeric(x))</span><br><span class="line">  </span><br><span class="line">  if (x%%3==0 &amp;&amp; x%%5!=0) &#123;</span><br><span class="line">    print(&quot;fizz&quot;)</span><br><span class="line">  &#125;else if (x%%5==0 &amp;&amp; x%%3!=0) &#123;</span><br><span class="line">    print(&quot;buzz&quot;)</span><br><span class="line">  &#125;else if (x%%5==0 &amp;&amp; x%%3==0) &#123;</span><br><span class="line">    print(&quot;fizzbuzz&quot;)</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    print(x)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>函数的参数：主要包括进行计算的<strong>数据</strong>，控制计算过程的<strong>细节</strong>，细节参数一般都有默认值<ul>
<li><strong>检查参数值：stopifnot()</strong></li>
<li><code>...</code>捕获任意数量的未匹配的参数，将这些捕获的值传递给另一个函数。</li>
</ul>
</li>
<li>返回值：通常是返回最后一个语句的值，可以通过<code>return()</code>提前返回一个值<ul>
<li>检查语句是否有误。</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">## 使用近似正态分布计算均值两端的置信区间</span><br><span class="line">mean_ci &lt;- function(x,confidence=0.95)&#123;</span><br><span class="line">  se &lt;- sd(x)/sqrt(length(x))</span><br><span class="line">  alpha &lt;- 1-confidence</span><br><span class="line">  mean(x)+se*qnorm(c(alpha/2,1-alpha/2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十五章，-向量vectors"><a href="#十五章，-向量vectors" class="headerlink" title="十五章， 向量vectors"></a>十五章， 向量vectors</h2><h4 id="一-向量概括"><a href="#一-向量概括" class="headerlink" title="一. 向量概括"></a>一. 向量概括</h4><p>向量vectors包括两种：原子向量(atomic vectors)和列表(list)</p>
<ul>
<li><strong>原子向量</strong> ：包括6种：logical,numeric(integer, double), character, complex, raw。向量种的各个值都是同种类型的；</li>
<li><strong>列表</strong>： 递归向量，列表中也可包括其它列表。列表中的各个值可以是不同类型的。</li>
<li><strong>拓展向量</strong>：向量中任意添加额外的<strong>元数据</strong>。</li>
<li><strong>探索函数：</strong><code>typeof()</code>, <code>length()</code></li>
</ul>
<p><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200903171710.png" alt=""></p>
<h4 id="二-原子向量"><a href="#二-原子向量" class="headerlink" title="二. 原子向量"></a>二. 原子向量</h4><ol>
<li>逻辑型(logical)包括三种：TRUE, FALSE, NA</li>
<li>数值型(numeric):默认数值为双精度型double；<ul>
<li>注意双精度型double是<strong>近似值(approximations)</strong>，所有的双精度值都当做是近似值处理，表示浮点数(floating point)</li>
<li>interger的特殊数据<code>NA</code>,double的特殊数据<code>NA, NaN,Inf,-Inf</code>需要以<code>is.finite()</code>等判断</li>
</ul>
</li>
<li>字符串(character)：可以包含任意数量的数据。</li>
</ol>
<h4 id="三-原子向量的操作"><a href="#三-原子向量的操作" class="headerlink" title="三. 原子向量的操作"></a>三. 原子向量的操作</h4><ol>
<li>强制转换：将一种原子强制转化为另一种；或者系统自动转化<ul>
<li><strong>显示型强制转化</strong>：<code>as.numeric</code>,<code>as.character</code>等；</li>
<li><strong>隐式强制转化</strong>：联系上下文context自动转化，如logical(T/F)———&gt;numeric(1/0);</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- sample(x = 20,size = 100,replace = T)</span><br><span class="line">y &lt;- x&gt;10</span><br><span class="line">mean(y);sum(y)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>检验是否为某一原子向量：利用purrr包中的函数<code>is_</code> ：<code>is_logical(), is_character</code>等</p>
</li>
<li><p>标量与循环的规则：处理不同长度的向量会遵循 <strong>向量循环规则</strong>。例如<code>1:10+1:3</code>：R会拓展较短的向量，使其与较长的向量一样长。然后再相加。</p>
</li>
<li><p>向量命名：所有类型的向量都是可以命名的.<strong>向量完成后利用：</strong><code>purrr::set_names(x,nm=c(&quot;q&quot;,&quot;w&quot;,&quot;e&quot;))</code>命名。</p>
</li>
<li><p>向量的取子集：<code>filter()</code>函数对tibble使用，对于向量的筛选则使用[]。</p>
<ul>
<li>整数型数值向量进行筛选：<code>x[c(1,2,2,4)]</code>, <code>x[c(-1,-2,-3)]</code></li>
<li>==使用逻辑向量取子集，提取出TRUE值对应的元素==。可利用<strong>比较函数</strong></li>
<li>对命名向量可用字符取子集</li>
<li><strong>x[]</strong> 代表选取x中的全部元素，对于矩阵十分重要<code>x[2,]</code>,<code>x[,-3]</code>；<strong>特殊的，[[]]</strong> 代表只提取单个元素。明确表示需要提取单个元素时使用</li>
</ul>
</li>
</ol>
<h4 id="四-列表（递归向量recrusive-vectors）"><a href="#四-列表（递归向量recrusive-vectors）" class="headerlink" title="四. 列表（递归向量recrusive vectors）"></a>四. 列表（递归向量recrusive vectors）</h4><ol>
<li>列表是建立在原子向量基础上的一种复杂形式，列表可以包含其它列表。列表保存层级结构，树形结构。<code>str()</code>，重点关注列表的结构。</li>
</ol>
<p><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200903174212.png" alt=""></p>
<ol start="2">
<li><strong>列表取子集</strong> :<ul>
<li><code>[]</code>提取子列表，<strong>返回的是一个子列表</strong>；可用逻辑向量，整数向量，字符向量提取。</li>
<li>使用<code>[[]]</code>从列表中提取单个元素，并非子列表。</li>
<li>直接使用<code>$</code>，作用相同于<code>[[]]</code>。综合使用。x[[1]][[1]]</li>
<li><strong>注意于tibble之间使用的异同点，tibble[1], tibble[[1]]</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a &lt;- list(a=1:3,b=&quot;a string&quot;,c=pi,d=list(-1,-5))</span><br><span class="line">a[c(1:2)]</span><br><span class="line">a[&quot;a&quot;]</span><br><span class="line">a[[&quot;a&quot;]][1:2]</span><br></pre></td></tr></table></figure>
<h4 id="五-特性："><a href="#五-特性：" class="headerlink" title="五. 特性："></a>五. 特性：</h4>任何向量都可以通过其特性来附加任意元数据。可以将特性看作可以附加在任何对象上的一个向量命名列表。<strong>维度、名称、类</strong>  </li>
</ul>
</li>
</ol>
<ul>
<li><strong>泛型函数</strong>：可以根据不同类型的输入而进行不同的操作。面向对象编程的关键。可以根据不同类型的输入而进行不同的操作。例如 <code>as.Data()</code></li>
</ul>
<h4 id="六-拓展向量："><a href="#六-拓展向量：" class="headerlink" title="六. 拓展向量："></a>六. 拓展向量：</h4><p>利用基础的原子向量和列表构建出的另外一些重要的向量类型，称为<strong>拓展向量，其具有类的附加特性</strong>。</p>
<ol>
<li>因子：在整数型向量的基础上构建的，添加了水平特征。表示<strong>有次序的分类数据</strong><code>factor(c(&quot;ef&quot;,&quot;cd&quot;,&quot;ab&quot;),levels=c(&quot;ab&quot;,&quot;cd&quot;,&quot;ef&quot;))</code></li>
<li>日期和日期时间：数值型的向量。</li>
<li>tibble：拓展的列表。</li>
</ol>
<hr>
<h2 id="Charpter16-purrr-Iteration"><a href="#Charpter16-purrr-Iteration" class="headerlink" title="Charpter16_purrr Iteration"></a>Charpter16_purrr Iteration</h2><p>迭代Iteration：对多个列或多个数据集进行相同的操作。两种迭代方式：</p>
<ul>
<li>命令型编程：<code>while()</code>, <code>for()</code>。</li>
<li>函数式编程。减少重复代码。</li>
</ul>
<h4 id="一-For循环"><a href="#一-For循环" class="headerlink" title="一. For循环"></a>一. For循环</h4><ul>
<li>需为输出结果分配出足够的空间。对循环效率十分重要。</li>
<li>涉及的函数包括 ==<code>vector(&quot;double&quot;,ncol(df))</code>, <code>seq_along(df)</code>, <code>[[]]</code>==<ol>
<li>output</li>
<li>for loop sequence</li>
<li>the body<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">###16.2 for循环</span><br><span class="line">require(tidyverse)</span><br><span class="line">df &lt;- tibble(a=rnorm(10),</span><br><span class="line">             b=rnorm(10),</span><br><span class="line">             c=rnorm(10),</span><br><span class="line">             d=rnorm(10))</span><br><span class="line"></span><br><span class="line">output &lt;- vector(&quot;double&quot;,ncol(df))</span><br><span class="line">output</span><br><span class="line">for (i in seq_along(df)) &#123;</span><br><span class="line">  output[i] &lt;- median(df[[i]])</span><br><span class="line">&#125;</span><br><span class="line">output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### exercise Alice the Camel</span><br><span class="line">humps &lt;- c(&quot;five&quot;, &quot;four&quot;,&quot;three&quot;,&quot;two&quot;,&quot;one&quot;,&quot;no&quot;)</span><br><span class="line">for (i in humps) &#123;</span><br><span class="line">  cat(str_c(&quot;Alice the camel has&quot;,rep(i,3),&quot;horse&quot;,collapse = &quot;\n&quot;),&quot;\n&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ul>
<h4 id="二-for循环的变体"><a href="#二-for循环的变体" class="headerlink" title="二. for循环的变体"></a>二. for循环的变体</h4><ol>
<li><p>修改现有对象：与自定义的函数function()一起使用。</p>
<ul>
<li>注意<strong>在循环loop中，所有for循环使用的都是<code>[[]]</code> ，明确表示是要处理单个元素。</strong></li>
<li><code>df[[i]] = rescale01(df[[i]])</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">### create a tibble</span><br><span class="line">df &lt;- tibble(</span><br><span class="line">  a = rnorm(10),</span><br><span class="line">  b = rnorm(10),</span><br><span class="line">  c = rnorm(10),</span><br><span class="line">  d = rnorm(10)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">### create a function</span><br><span class="line">rescale01 &lt;- function(x) &#123;</span><br><span class="line">  rng &lt;- range(x, na.rm = TRUE)</span><br><span class="line">  (x - rng[1]) / (rng[2] - rng[1])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">### use the loop</span><br><span class="line">for (i in )</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>循环模式：</p>
<ul>
<li>通过对<strong>数值索引</strong>进行循环，再通过x[[i]]提取相应的值。</li>
<li>通过对<strong>元素element索引</strong>。</li>
<li>通过使用<strong>名称索引</strong>：<code>for (i in names(x))</code>，需要使用元素的名称时使用。<strong>有利于图表标题和文件名</strong></li>
</ul>
</li>
<li><p>处理未知的输出长度。</p>
<ul>
<li><strong>应该将loop每次的结果保存再一个列表中，循环结束后再利用<code>unlist()</code> 或者<code>purrr::flatten_dbl()</code>组合成一个向量</strong></li>
<li>当遇到类似的问题，如生成一个很长的字符串<code>paste(out,collapse=&quot;&quot;)</code>，或是个很大的数据框 ==<code>rbind_rows()</code>, <code>unlist()</code>== 。<strong>应首先使用一个更复杂的对象来保存每次迭代的结果，最后再一次性的组合起来。</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">means &lt;- c(0,1,2)</span><br><span class="line">output &lt;- double()</span><br><span class="line">for (i in seq_along(means)) &#123;</span><br><span class="line">  n &lt;- sample(100,1)</span><br><span class="line">  output &lt;- c(output,rnorm(n,mean = means[[i]])) ### 十分不高效，这里会复制上一次的所有数据。</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">##高效法 </span><br><span class="line">out &lt;- vector(&quot;list&quot;,length = length(means))</span><br><span class="line">for (i in seq_along(means))&#123;</span><br><span class="line">  n &lt;- sample(100,1)</span><br><span class="line">  out[[i]] &lt;- rnorm(n,mean = means[[i]])</span><br><span class="line">&#125;</span><br><span class="line">unlist(out)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>处理未知长度的序列。利用while循环来实现。</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">for (i in seq_along(x))&#123;</span><br><span class="line">    # body</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## equivalent to </span><br><span class="line">i &lt;- 1</span><br><span class="line">while(i &lt;= length(x))&#123;</span><br><span class="line">    # body</span><br><span class="line">    i&lt;- i + 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>Exercises</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">####exercises</span><br><span class="line"># 1.读取文件，保存在大的数据框中</span><br><span class="line">files &lt;- dir(path = &quot;.&quot;,pattern = &quot;tsv$&quot;,full.names = F) ###匹配某一路径下所有的文件。</span><br><span class="line">data_list &lt;- vector(&quot;list&quot;,length = length(files))</span><br><span class="line">for (i in seq_along(files)) &#123;</span><br><span class="line">  data_list[[i]] &lt;- read_delim(files[[i]],delim = &quot;\t&quot;)</span><br><span class="line">&#125;</span><br><span class="line">bind_rows(data_list)</span><br><span class="line"></span><br><span class="line">#2.输出所有df中数值列的均值及名称show_mean(iris)</span><br><span class="line">iris &lt;- as_tibble(iris)</span><br><span class="line">show_means &lt;- function(df,digits=2)&#123;</span><br><span class="line">  maxstr &lt;- max(str_length(names(df)))</span><br><span class="line">  for (i in names(df)) &#123;</span><br><span class="line">  if (is.numeric(df[[i]])) &#123;</span><br><span class="line">    cat(</span><br><span class="line">      str_c(str_pad(str_c(i,&quot;:&quot;),maxstr+1L,side = &quot;right&quot;),</span><br><span class="line">            format(mean(df[[i]]),digits=2,nsmall=2),</span><br><span class="line">                   sep=&quot; &quot;</span><br><span class="line">              ),</span><br><span class="line">     sep =  &quot;\n&quot;  </span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="三-for循环与函数式编程"><a href="#三-for循环与函数式编程" class="headerlink" title="三. for循环与函数式编程"></a>三. for循环与函数式编程</h4><ul>
<li>函数式编程语言意味着可以先将for循环包装在函数中。即<strong>将函数名作为参数传入到另一个函数中</strong></li>
<li>利用purrr函数，可以将复杂问题解决成子问题，然后再通过管道操作将这些问题的结果组合起来。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">col_summary &lt;- function(x,fun)&#123;</span><br><span class="line">  out &lt;- vector(&quot;double&quot;,length(x))</span><br><span class="line">  for (i in seq_along(x)) &#123;</span><br><span class="line">    out[[i]]=fun(x[[i]])</span><br><span class="line">  &#125;</span><br><span class="line">  out</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## so, we can use a funtion in fun parameter.</span><br><span class="line"></span><br><span class="line">col_summary(df,median) ## calculate the median value of each column.</span><br></pre></td></tr></table></figure>

<h4 id="四-映射函数-The-map-function"><a href="#四-映射函数-The-map-function" class="headerlink" title="四. 映射函数 The map function."></a>四. 映射函数 The map function.</h4><p>purrr包函数<code>map()</code>(返回的是列表),<code>map_lgl()</code>,<code>map_dbl()</code>,<code>map_chr()</code>。map()第二个参数可以是<strong>公式，字符向量，整型向量</strong>，==<code>...</code>== 作为.function 的附加参数。第三个参数为第二个函数中的附加参数。例如： <code>map_dbl(df, mean, trim = 0.5)</code>。<strong>在对列表中的各个子集内部进行筛选，返回的依旧是个列表</strong></p>
<ol>
<li>快捷方式(shortcuts)：对某个数据集中的每个分组都拟合一个线性模型。类似于factor中的一些功能。<ul>
<li>==<code>.</code>== 作为一个代词，代表当前的列表元素。</li>
<li>==<code>~</code>== 作为function(x)</li>
<li>==<code>~.$r.squared</code>== 结合</li>
<li>提取命名成分<code>map_dbl(~.$r.squared)</code>, or <code>map_dbl(2)</code>循环取列表里的第2个值。</li>
</ul>
</li>
<li>BaseR 中的apply函数组。lapply(), sapply(), vapply()。而purrr作为Hardley开发的，具有更加一致的map_*名字和参数，<code>. ~</code>的快捷方式，并行计算，以及计算的进度条。</li>
<li>exercises中涉及的一些函数：<code>map(-2:2,rnorm, n=5)</code>, <code>map(1:3,rnorm,mean=10)</code>.</li>
<li>对操作失败的处理：<code>safely(), possibly(), quietly()</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">### split 分割出列表</span><br><span class="line">models &lt;- mtcars %&gt;% </span><br><span class="line">  split(.$cyl) %&gt;% </span><br><span class="line">  map(function(df) lm(mpg ~ wt,data=df)) ##  df是一个匿名函数，可任意命名。</span><br><span class="line">  </span><br><span class="line">## alias:</span><br><span class="line">models &lt;- mtcars %&gt;% split( .$cyl) %&gt;% map( ~ lm(mpg ~ wt,data=.))</span><br><span class="line"></span><br><span class="line">### extract the componet</span><br><span class="line">models %&gt;% </span><br><span class="line">  map(summary) %&gt;% </span><br><span class="line">  map_dbl(~.$r.squared)</span><br><span class="line">#&gt;     4     6     8 </span><br><span class="line">#&gt; 0.509 0.465 0.423</span><br><span class="line"></span><br><span class="line">map(out, ~ .[. &gt; 0.8]) ###筛选每一列中大于0.8的数据。</span><br><span class="line"></span><br><span class="line">map(df,function(xxx) length(unique(xxx))`——》`map(df, ~ length(unique(.)))</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h4 id="五-多参数映射mapping-over-multiple-arguments"><a href="#五-多参数映射mapping-over-multiple-arguments" class="headerlink" title="五. 多参数映射mapping over multiple arguments"></a>五. 多参数映射mapping over multiple arguments</h4><ol>
<li><code>map2(), pmap()</code>对每一列的功能操作会涉及到多个参数时，就需要利用此函数。注意<strong>每次调用时候，发生变化的参数放在函数功能的前面位置，值保持不变的参数放在映射函数的后面；参数为list</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mu &lt;- list(5,10,-3)</span><br><span class="line">map(mu, rnorm, n=5)</span><br><span class="line">### map2 的应用</span><br><span class="line">sigma &lt;- list(1,5,10)</span><br><span class="line">map2(mu,sigma,rnorm,n=5)</span><br><span class="line">### pmap()应用，多个参数都未定，就将参数保存到大列表中</span><br><span class="line">n &lt;- list(3,5,8)</span><br><span class="line">args &lt;- list(n=n,sd=sigma,mean=mu)</span><br><span class="line">pmap(args,rnorm)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200904173908.png" alt=""></p>
<ol start="2">
<li><strong>多个参数</strong> 对于<code>pmap()</code>函数，可以将多个输入列表作为参数。且多个列表的长度一样*<em>可以转换为tibble，确保每列都有名称，且与其它列具有相同的长度 *</em></li>
</ol>
<p><img src="https://gitee.com/tianpeng__wang/image/raw/master/tianpeng_pic/20200904173846.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">params &lt;- tribble(</span><br><span class="line">  ~mean, ~sd, ~n,</span><br><span class="line">    5,     1,  1,</span><br><span class="line">   10,     5,  3,</span><br><span class="line">   -3,    10,  5</span><br><span class="line">)</span><br><span class="line">params %&gt;% </span><br><span class="line">  pmap(rnorm)</span><br><span class="line">#&gt; [[1]]</span><br><span class="line">#&gt; [1] 6.02</span><br><span class="line">#&gt; </span><br><span class="line">#&gt; [[2]]</span><br><span class="line">#&gt; [1]  8.68 18.29  6.13</span><br><span class="line">#&gt; </span><br><span class="line">#&gt; [[3]]</span><br><span class="line">#&gt; [1] -12.24  -5.76  -8.93  -4.22   8.80</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>多个参数，且多个映射函数</strong>，利用<code>invoke_map()</code>函数，参数不同，甚至函数本身也不同。（invoke 调用）</li>
</ol>
<h4 id="六-游走函数，预测函数，归纳与累计"><a href="#六-游走函数，预测函数，归纳与累计" class="headerlink" title="六. 游走函数，预测函数，归纳与累计"></a>六. 游走函数，预测函数，归纳与累计</h4><ol>
<li>游走函数walk，输出保存多个文件时非常实用。<code>walk(), pwalk()</code>。<ul>
<li>例如有一个图形列表和一个文件名的向量，可以使用pwalk()将每个文件保存到相应的位置。</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)</span><br><span class="line">plots &lt;- mtcars %&gt;% split(.$cyl) %&gt;% </span><br><span class="line">  map( ~ ggplot(data = .,mapping = aes(mpg,wt))+geom_point())</span><br><span class="line">  path=stringi::stri_c(names(plots),&quot;.pdf&quot;)</span><br><span class="line">  </span><br><span class="line">  pwalk(list(path,plots),ggsave,path=tempdir())</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>预测函数<code>keep(), discard()</code>函数可以保留输入中预测值为TRUE和FALSE的元素。<code>some(), every()</code>分别用来确定预测值是否对某个元素为真。<code>detect()</code>找出预测值为真的第一个元素，<code>detect_index()</code>返回找到的元素的位置。</p>
</li>
<li><p>归纳约简与累计 reduce/accumulate：复杂列表简化为一个简单列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vs &lt;- list(c(1,2,3,4,5),</span><br><span class="line">           c(1,2,3,4),</span><br><span class="line">           c(1,2,3))</span><br><span class="line">reduce(vs,intersect)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="charpter21-ggplot2-graphics-for-communication"><a href="#charpter21-ggplot2-graphics-for-communication" class="headerlink" title="charpter21_ggplot2(graphics for communication)"></a>charpter21_ggplot2(graphics for communication)</h2><ol>
<li>标签labels:<code>labs()</code><ul>
<li><code>title=&quot;&quot;</code> <strong>主标题</strong></li>
<li><code>subtitle=&quot;&quot;</code> <strong>副标题</strong>，添加附加信息；</li>
<li><code>caption= &quot; &quot;</code> <strong>描述数据来源</strong> 右下角添加信息</li>
<li><code>x=&quot; &quot;, y=&quot; &quot;</code><strong>坐标轴信息</strong></li>
<li><code>color= &quot;&quot;</code> <strong>图例中的标题</strong></li>
<li><code>x= quote()</code> <strong>坐标轴上使用数学公式</strong></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)</span><br><span class="line">require(tidyverse)</span><br><span class="line">ggplot(mpg,aes(displ,hwy))+geom_point(aes(color=class))+labs(title = &quot;aaaaa&quot;,subtitle = &quot;bbbbb&quot;,caption = &quot;cccc &quot;,x=&quot;HWY&quot;,y=&quot;DISPL&quot;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>注释Annotation：为单个或分组的观测值添加标签。</p>
<ul>
<li><code>filter(row_number(desc(hwy))==1)</code> 筛选每个组中hwy数值最高的观测observation。</li>
<li><code>geom_point() + geom_text(aes(label= ),data=)</code></li>
<li>利用<strong>ggrepel包可以自动调整注释标签的位置</strong>  <code>geom_label_repel(aes(label=))</code></li>
<li><strong>将标题加在图形里的右上角角落上</strong></li>
<li><strong>添加参考线</strong><code>geom_hline()</code>,<code>geom_vline(size=2,color=white)</code></li>
<li><strong>感兴趣的点周围添加个矩形</strong> <code>geom_rect()</code></li>
<li><strong>绘制箭头，指向关注的数据点</strong><code>geom_segment()</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)</span><br><span class="line">library(ggrepel)</span><br><span class="line">best_in_class &lt;- mpg %&gt;% group_by(class) %&gt;% filter(row_number(desc(hwy))==1)</span><br><span class="line">ggplot(mpg,aes(displ,hwy))+geom_point(aes(color=class))+geom_text(mapping = aes(label=model),data = best_in_class)</span><br><span class="line">### 利用ggrepel用较大的空心圆来强调</span><br><span class="line">ggplot(mpg,aes(displ,hwy))+geom_point(aes(color=class))+geom_point(size=4,shape=1,data = best_in_class)+geom_label_repel(aes(label=model),data = best_in_class)</span><br><span class="line"></span><br><span class="line">### 将标题加在图形里的右上角角落上。</span><br><span class="line">label &lt;- mpg %&gt;% summarise(displ=max(displ),hwy=max(hwy),label=&quot;AAAA\nbbbbbbbb&quot;)</span><br><span class="line">ggplot(mpg,aes(displ,hwy))+geom_point()+geom_text(aes(label=label),data = label,vjust=&quot;top&quot;,hjust=&quot;right&quot;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>标度scale:控制从数据值到图形属性的映射。scale_x（图形属性名称）_continuous()（连续型/离散型/时间/日期时间型）</p>
<ul>
<li><strong>调整坐标轴axis ticks：</strong> <strong>刻度</strong> <code>scale_y_continuous(breaks=seq(1,40,by=5))</code>,<strong>坐标轴图例项目</strong><code>scale_y_continuous(labels=NULL)</code></li>
<li><strong>图例legend</strong>:<code>theme(legend.position=&quot;none/right/left/top/bottom&quot;)</code>, 控制图例的显示guides(guide_legend())</li>
<li><strong>标度替换</strong>：对标度进行数学转换。</li>
<li><strong>颜色的转换</strong>：利用RColorBrewer/ggsci包,对于数量少的legend，可以添加形状映射。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ggplot(mpg,aes(displ,hwy))+geom_point(aes(color=class))+geom_smooth(se=F,color=&quot;darkgrey&quot;)+theme(legend.position = &quot;bottom&quot;)+guides(color=guide_legend(nrow = 1,override.aes = list(size=4)))</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">library(ggsci)</span><br><span class="line">library(RColorBrewer)</span><br><span class="line">ggplot(mpg,aes(displ,hwy))+geom_point(aes(color=drv))+scale_color_brewer(palette = &quot;Set1&quot;)</span><br><span class="line">ggplot(mpg,aes(displ,hwy))+geom_point(aes(color=drv,shape=drv))+scale_color_aaas()</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>缩放，控制图形范围。<code>coord_cartesian()</code>函数设置xlim和ylim的参数值。</li>
<li>主题(themes)：定制图形中的非数据元素。<code>theme_bw()</code>,<code>theme_grey()（默认）</code>,<code>theme_classic()</code>,<code>theme_light()</code></li>
<li>保存图形<code>ggsave()</code></li>
</ol>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2020/09/07/R-4ds/">R数据科学 R for data sciences</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Tianpeng Wang</a></p>
        <p><span>发布时间:</span>2020-09-07, 16:48:30</p>
        <p><span>最后更新:</span>2020-09-07, 10:54:40</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2020/09/07/R-4ds/" title="R数据科学 R for data sciences">http://wangtp.top/2020/09/07/R-4ds/</a>
            <span class="copy-path" data-clipboard-text="原文: http://wangtp.top/2020/09/07/R-4ds/　　作者: Tianpeng Wang" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2020/09/29/%E5%9F%BA%E4%BA%8E%E5%8D%95%E4%BD%93%E5%9E%8Bhaplotypes%E7%9A%84%E7%BE%A4%E4%BD%93%E9%80%89%E6%8B%A9%E4%BF%A1%E5%8F%B7%E7%9A%84%E6%A3%80%E6%B5%8B%E2%80%94%E2%80%94EHH%20&%20iHS/">
                    基于单体型haplotypes的群体选择信号的检测——EHH &amp; iHS
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2020/08/31/Git_%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86/">
                    Git_版本控制的项目流程管理
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一-使用ggplot2进行数据可视化"><span class="toc-number">2.</span> <span class="toc-text">一 使用ggplot2进行数据可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二-工作流：基础-Workflow：basics"><span class="toc-number">3.</span> <span class="toc-text">二 工作流：基础 Workflow：basics</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三-使用dplyr进行数据转换"><span class="toc-number">4.</span> <span class="toc-text">三 使用dplyr进行数据转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五，探索性数据分析-exploratory-data-analysis-EDA"><span class="toc-number">5.</span> <span class="toc-text">五，探索性数据分析 exploratory data analysis(EDA)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七，-tibble"><span class="toc-number">6.</span> <span class="toc-text">七， tibble</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八，-使用readr进行数据的导入"><span class="toc-number">7.</span> <span class="toc-text">八， 使用readr进行数据的导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#九，使用tidyr整理数据表-Tidy-data"><span class="toc-number">8.</span> <span class="toc-text">九，使用tidyr整理数据表 Tidy data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#九，使用dplyr处理关系数据，多个数据表。"><span class="toc-number">9.</span> <span class="toc-text">九，使用dplyr处理关系数据，多个数据表。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十章-使用stringr处理字符串。"><span class="toc-number">10.</span> <span class="toc-text">十章 使用stringr处理字符串。</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#10-1-字符串基础"><span class="toc-number">10.0.0.1.</span> <span class="toc-text">10.1 字符串基础</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-2-正则匹配"><span class="toc-number">10.0.0.2.</span> <span class="toc-text">10.2 正则匹配</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-3-各类匹配操作"><span class="toc-number">10.0.0.3.</span> <span class="toc-text">10.3 各类匹配操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-5-其它类型的匹配"><span class="toc-number">10.0.0.4.</span> <span class="toc-text">10.5 其它类型的匹配</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十一章-使用forcats处理因子"><span class="toc-number">11.</span> <span class="toc-text">十一章 使用forcats处理因子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十四章-函数-Functions"><span class="toc-number">12.</span> <span class="toc-text">十四章 函数(Functions)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十五章，-向量vectors"><span class="toc-number">13.</span> <span class="toc-text">十五章， 向量vectors</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一-向量概括"><span class="toc-number">13.0.1.</span> <span class="toc-text">一. 向量概括</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#二-原子向量"><span class="toc-number">13.0.2.</span> <span class="toc-text">二. 原子向量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#三-原子向量的操作"><span class="toc-number">13.0.3.</span> <span class="toc-text">三. 原子向量的操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#四-列表（递归向量recrusive-vectors）"><span class="toc-number">13.0.4.</span> <span class="toc-text">四. 列表（递归向量recrusive vectors）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#五-特性："><span class="toc-number">13.0.5.</span> <span class="toc-text">五. 特性：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#六-拓展向量："><span class="toc-number">13.0.6.</span> <span class="toc-text">六. 拓展向量：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Charpter16-purrr-Iteration"><span class="toc-number">14.</span> <span class="toc-text">Charpter16_purrr Iteration</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一-For循环"><span class="toc-number">14.0.1.</span> <span class="toc-text">一. For循环</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#二-for循环的变体"><span class="toc-number">14.0.2.</span> <span class="toc-text">二. for循环的变体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#三-for循环与函数式编程"><span class="toc-number">14.0.3.</span> <span class="toc-text">三. for循环与函数式编程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#四-映射函数-The-map-function"><span class="toc-number">14.0.4.</span> <span class="toc-text">四. 映射函数 The map function.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#五-多参数映射mapping-over-multiple-arguments"><span class="toc-number">14.0.5.</span> <span class="toc-text">五. 多参数映射mapping over multiple arguments</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#六-游走函数，预测函数，归纳与累计"><span class="toc-number">14.0.6.</span> <span class="toc-text">六. 游走函数，预测函数，归纳与累计</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#charpter21-ggplot2-graphics-for-communication"><span class="toc-number">15.</span> <span class="toc-text">charpter21_ggplot2(graphics for communication)</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"true"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"R数据科学 R for data sciences　| Dawn_Wang's blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2020/09/29/%E5%9F%BA%E4%BA%8E%E5%8D%95%E4%BD%93%E5%9E%8Bhaplotypes%E7%9A%84%E7%BE%A4%E4%BD%93%E9%80%89%E6%8B%A9%E4%BF%A1%E5%8F%B7%E7%9A%84%E6%A3%80%E6%B5%8B%E2%80%94%E2%80%94EHH%20&%20iHS/" title="上一篇: 基于单体型haplotypes的群体选择信号的检测——EHH &amp; iHS">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2020/08/31/Git_%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86/" title="下一篇: Git_版本控制的项目流程管理">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/02/15/Phylogenomic-Tutorial-IntrogressionDetection-with-SNP/">Phylogenomic_Tutorial_IntrogressionDetection_with_SNP</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/02/Phylogenomic-Tutorial-SpeciesTree-with-SNP/">Phylogenomic-Tutorial-SpeciesTree-with-SNP</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/02/Phylogenomic-Tutorial-DivergenceTime-with-SNP/">Phylogenomic_Tutorial_DivergenceTime_with_SNP</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/25/Phylogenomic-Tutorial-LocalAssembly-orthologs/">Phylogenomic_Tutorial || Local Assembly of specific orthologs</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/24/Phylogenomic_Tutorial_Bayesian%20SpeciesTree_Inference/">Phylogenomic_Tutorial || Bayesian Species Tree Inference</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/23/Phylogenomic_Tutorial_SpeciesTree_ML/">Phylogenomic_Tutorial || SpeciesTree Inference by ML</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/21/Phylogenomic_Tutorial_Ortholog%20Detection/">Phylogenomic_Tutorial || Ortholog Detection</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/15/Phylogenomic_Tutorial_Divergence%20Time%20Estimation/">Phylogenomic_Tutorial || Divergence Time Estimation</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/15/Phylogenomic_Tutorial_Bayesian%20Phylogenetic%20Inference/">Phylogenomic_Tutorial || Bayesian Phylogenetic Inference</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/15/Phylogenomic_Tutorial_ML_Tree%20inference/">Phylogenomic_Tutorial || ML_Tree inference</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/29/%E5%9F%BA%E4%BA%8E%E5%8D%95%E4%BD%93%E5%9E%8Bhaplotypes%E7%9A%84%E7%BE%A4%E4%BD%93%E9%80%89%E6%8B%A9%E4%BF%A1%E5%8F%B7%E7%9A%84%E6%A3%80%E6%B5%8B%E2%80%94%E2%80%94EHH%20&%20iHS/">基于单体型haplotypes的群体选择信号的检测——EHH & iHS</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/07/R-4ds/">R数据科学 R for data sciences</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/31/Git_%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B5%81%E7%A8%8B%E7%AE%A1%E7%90%86/">Git_版本控制的项目流程管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/04/%E5%9F%BA%E5%9B%A0%E6%B5%81%E4%B8%8E%E6%B8%90%E6%B8%97%E5%88%86%E6%9E%90%E2%80%94%E2%80%94D-statistics/">基因流与渐渗分析——D-statistics</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/02/Pophelper-%E7%BE%A4%E4%BD%93%E7%BB%93%E6%9E%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%AD%A6%E4%B9%A0/">Pophelper-群体结构可视化学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/15/%E5%85%A8%E5%9F%BA%E5%9B%A0%E7%BB%84%E5%88%86%E6%9E%90_%E5%9F%BA%E5%9B%A0%E5%9E%8B%E5%AE%9A%E7%9B%B8%E5%92%8C%E5%A1%AB%E5%85%85(Phasing%20and%20Imputation)/">全基因组分析_基因型定相和填充(Phasing and Imputation)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/21/%E5%9F%BA%E5%9B%A0%E6%B8%90%E6%B8%97%E5%88%86%E6%9E%90%E2%80%94%E2%80%94introgression/">基因渐渗分析——introgression</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/03/BCFtools%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/">BCFtools使用说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/03/VCFtools%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/">VCFTOOLS使用说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/26/Perl%E5%8D%95%E8%A1%8C%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/">Perl单行命令记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/25/%E5%85%A8%E5%9F%BA%E5%9B%A0%E7%BB%84%E5%88%86%E6%9E%90_%E9%80%89%E6%8B%A9%E5%8E%8B%E5%8A%9B%E5%88%86%E6%9E%90/">全基因组分析 || 选择压力分析_基础知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/24/Daily-statistics-%E5%88%86%E4%BD%8D%E6%95%B0/">Daily-statistics_分位数</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/23/%E7%94%9F%E4%BF%A1%E5%8D%95%E8%A1%8C%E8%84%9A%E6%9C%AC/">生信单行脚本记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/21/Daily-statistics-%E6%A6%82%E7%8E%87%E5%92%8C%E4%BC%BC%E7%84%B6/">Daily-statistics_概率和似然</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/20/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99-%E9%AB%98%E6%95%88%E5%9B%BE%E5%BA%8A-%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/">个人网站+高效图床 搭建记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/16/Daily-statistics/">Daily_statistics_置信区间+Pvalue+单尾双尾P值</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/27/Hello_World/">Hello World!</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2019-2021 Tianpeng Wang
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>

        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
        </script>
           
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>


        
    </div>
</footer>


    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>
<!--动态线条背景-->
<script type="text/javascript"
color="220,220,220" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script type="text/javascript" src="\js\line.js"></script>